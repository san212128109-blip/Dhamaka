<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Customer Panel</title>
<style>
body{font-family:Arial,sans-serif;background:#f0f2f5;margin:0;padding:0;}
header{background:#007bff;color:white;padding:1em;text-align:center;}
h2{margin-top:1em;}
.container{padding:1em;}
.product-list{display:flex;flex-wrap:wrap;gap:1em;}
.product{background:white;padding:1em;border-radius:10px;flex:1;min-width:200px;box-shadow:0 0 5px rgba(0,0,0,0.2);}
button{padding:0.3em 0.6em;margin:0.2em;cursor:pointer;}
.review-box{margin-top:0.5em;}
.review-box textarea{width:100%;height:50px;border-radius:5px;padding:0.3em;}
.review-box button{margin-top:0.2em;}
.review-list{margin-top:0.5em;border-top:1px solid #ccc;padding-top:0.5em;}
.review-item{border-bottom:1px dashed #ccc;margin-bottom:0.5em;padding-bottom:0.3em;}
</style>
</head>
<body>

<header>
<h1>Customer Panel</h1>
<div id="loginSection">
<input type="text" id="custName" placeholder="Enter Name">
<button onclick="loginCustomer()">Login</button>
</div>
<div id="welcomeSection" style="display:none;">
Welcome, <span id="custDisplay"></span>! <button onclick="logoutCustomer()">Logout</button>
</div>
</header>

<div class="container" id="customerPanel" style="display:none;">
<h2>Available Products</h2>
<div class="product-list" id="productList"></div>
</div>

<script>
// Customer login
let currentCustomer = localStorage.getItem("currentCustomer")||"";

function loginCustomer(){
  let name = document.getElementById("custName").value.trim();
  if(!name){ alert("Enter your name"); return; }
  currentCustomer=name;
  localStorage.setItem("currentCustomer",currentCustomer);
  document.getElementById("custDisplay").innerText=currentCustomer;
  document.getElementById("loginSection").style.display="none";
  document.getElementById("welcomeSection").style.display="block";
  document.getElementById("customerPanel").style.display="block";
  renderProducts();
}

function logoutCustomer(){
  localStorage.removeItem("currentCustomer");
  currentCustomer="";
  document.getElementById("loginSection").style.display="block";
  document.getElementById("welcomeSection").style.display="none";
  document.getElementById("customerPanel").style.display="none";
}

// Render products
function renderProducts(){
  let productList = document.getElementById("productList");
  let products = JSON.parse(localStorage.getItem("approvedProducts")||'[]');
  productList.innerHTML='';
  products.forEach((p,i)=>{
    let div = document.createElement("div");
    div.className="product";
    let reviews = JSON.parse(localStorage.getItem("reviews")||'[]');
    let productReviews = reviews.filter(r=>r.product===p.name);
    div.innerHTML=`
      <h3>${p.name}</h3>
      <p>Category: ${p.category}</p>
      <p>Price: $${p.price}</p>
      <p>Stock: ${p.stock}</p>
      <div class="review-box">
        <textarea id="rev-${i}" placeholder="Write a review..."></textarea>
        <button onclick="addReview(${i})">Submit Review</button>
      </div>
      <div class="review-list">
        ${productReviews.map(r=>`<div class="review-item"><strong>${r.customer}:</strong> ${r.text}</div>`).join('')}
      </div>
    `;
    productList.appendChild(div);
  });
}

// Add review
function addReview(index){
  if(!currentCustomer){ alert("Login first"); return; }
  let products = JSON.parse(localStorage.getItem("approvedProducts")||'[]');
  let reviews = JSON.parse(localStorage.getItem("reviews")||'[]');
  let text = document.getElementById(`rev-${index}`).value.trim();
  if(!text){ alert("Enter review"); return; }
  reviews.push({product:products[index].name,customer:currentCustomer,text:text});
  localStorage.setItem("reviews",JSON.stringify(reviews));
  document.getElementById(`rev-${index}`).value='';
  renderProducts();
}

// Auto-login if previously logged in
if(currentCustomer){
  document.getElementById("custDisplay").innerText=currentCustomer;
  document.getElementById("loginSection").style.display="none";
  document.getElementById("welcomeSection").style.display="block";
  document.getElementById("customerPanel").style.display="block";
  renderProducts();
}
</script>

</body>
</html>
