<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Vendor Dashboard | Dhamaka Marketplace</title>
Â  Â  <style>
Â  Â  Â  Â  /* Base Styles */
Â  Â  Â  Â  body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f4f4f4; color: #333; margin: 0; padding: 0; }
Â  Â  Â  Â  header { background: #343a40; color: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); }
Â  Â  Â  Â  header h1 { margin: 0; font-size: 1.5em; }
Â  Â  Â  Â  .container { max-width: 1200px; margin: 20px auto; padding: 0 20px; }

Â  Â  Â  Â  /* General UI */
Â  Â  Â  Â  .page { display: none; }
Â  Â  Â  Â  h2 { border-bottom: 2px solid #ccc; padding-bottom: 10px; margin-top: 20px; }
Â  Â  Â  Â  button { background: #007bff; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; transition: background-color 0.3s; margin: 5px; }
Â  Â  Â  Â  button:hover { background: #0056b3; }
Â  Â  Â  Â  input[type="text"], input[type="password"], input[type="number"], input[type="url"], select { padding: 10px; margin: 5px 0; border: 1px solid #ccc; border-radius: 5px; width: 100%; box-sizing: border-box; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Auth Styles */
Â  Â  Â  Â  .auth-form { max-width: 400px; margin: 50px auto; padding: 30px; background: white; border-radius: 10px; box-shadow: 0 0 15px rgba(0, 0, 0, 0.1); }
Â  Â  Â  Â  .auth-form button { width: 100%; margin: 10px 0; }
Â  Â  Â  Â  .auth-form p { text-align: center; margin-top: 15px; color: #007bff; cursor: pointer; }
Â  Â  Â  Â  #msg, #regMsg { color: red; font-weight: bold; text-align: center; margin-bottom: 10px; }

Â  Â  Â  Â  /* Product Management */
Â  Â  Â  Â  .product-form { background: #e9ecef; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
Â  Â  Â  Â  .form-row { display: flex; gap: 20px; margin-bottom: 10px; }
Â  Â  Â  Â  .form-row > div { flex: 1; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Table Styles */
Â  Â  Â  Â  table { width: 100%; border-collapse: collapse; background: white; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); }
Â  Â  Â  Â  th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
Â  Â  Â  Â  th { background: #007bff; color: white; }
Â  Â  Â  Â  .product-img { width: 50px; height: 50px; object-fit: cover; border-radius: 4px; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Status Colors */
Â  Â  Â  Â  .status-approved { color: #28a745; font-weight: bold; }
Â  Â  Â  Â  .status-pending { color: orange; font-weight: bold; }

Â  Â  Â  Â  /* Specific Buttons */
Â  Â  Â  Â  button.delete { background: #dc3545; }
Â  Â  Â  Â  button.delete:hover { background: #c82333; }
Â  Â  Â  Â  button.update { background: #ffc107; color: #333; }
Â  Â  Â  Â  button.update:hover { background: #e0a800; }
Â  Â  </style>
</head>
<body>

Â  Â  <div id="loginPage" class="page">
Â  Â  Â  Â  <div class="auth-form">
Â  Â  Â  Â  Â  Â  <h2>Vendor Login</h2>
Â  Â  Â  Â  Â  Â  <div id="msg"></div>
Â  Â  Â  Â  Â  Â  <input type="text" id="vendorWhatsappLogin" placeholder="WhatsApp Number" required>
Â  Â  Â  Â  Â  Â  <input type="password" id="vendorPass" placeholder="Password" required>
Â  Â  Â  Â  Â  Â  <button onclick="vendorLogin()">Login</button>
Â  Â  Â  Â  Â  Â  <p onclick="showRegister()">Don't have an account? Register Here</p>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="registerPage" class="page">
Â  Â  Â  Â  <div class="auth-form">
Â  Â  Â  Â  Â  Â  <h2>Vendor Registration</h2>
Â  Â  Â  Â  Â  Â  <div id="regMsg"></div>
Â  Â  Â  Â  Â  Â  <input type="text" id="regName" placeholder="Business Name" required>
Â  Â  Â  Â  Â  Â  <input type="text" id="regWhatsapp" placeholder="WhatsApp Number (e.g. 88017xxxxxxxx)" required>
Â  Â  Â  Â  Â  Â  <input type="password" id="regPass" placeholder="Password" required>
Â  Â  Â  Â  Â  Â  <button onclick="vendorRegister()">Register</button>
Â  Â  Â  Â  Â  Â  <p onclick="showLogin()">Already have an account? Login Here</p>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="dashboardPage" class="page container">
Â  Â  Â  Â  <header>
Â  Â  Â  Â  Â  Â  <div style="display:flex; align-items:center;">
Â  Â  Â  Â  Â  Â  Â  Â  <h1 id="vendorName">Vendor Dashboard</h1>
Â  Â  Â  Â  Â  Â  Â  Â  <span style="margin-left: 20px; color: #00ffff;">Promo: <strong id="vendorPromoCode">VENDXXX</strong></span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <button onclick="logout()">Logout</button>
Â  Â  Â  Â  </header>

Â  Â  Â  Â  <h2>Product Management</h2>

Â  Â  Â  Â  <div class="product-form">
Â  Â  Â  Â  Â  Â  <h3 id="formTitle">Add Product</h3>
Â  Â  Â  Â  Â  Â  <div class="form-row">
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label>Product Name</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="prodName" placeholder="e.g. Premium T-Shirt" required>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label>Category</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="prodCategory" placeholder="e.g. Apparel, Electronics" required>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label>Price ($)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="prodPrice" placeholder="e.g. 500" min="1" required>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label>Stock Quantity</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="prodStock" placeholder="e.g. 100" min="0" required>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="form-row">
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label>Image URL</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="url" id="prodImageURL" placeholder="File path (e.g. ./images/my_product.jpg) or Direct Link">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label>Assign Promo Code</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="prodPromoCode">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">No Special Promo</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <button id="addProductBtn" onclick="addProduct()">Add Product</button>
Â  Â  Â  Â  Â  Â  <button id="updateProductBtn" onclick="updateProduct()" style="display:none;">Update Product</button>
Â  Â  Â  Â  Â  Â  <button id="cancelEditBtn" onclick="resetForm()" style="display:none; background:#6c757d;">Cancel</button>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <h3>My Product Listings (Requires Admin Approval)</h3>
Â  Â  Â  Â  <table id="productTable">
Â  Â  Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Name</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Category</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Price</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Stock</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Image</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Status</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Promo</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Actions</th>
Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  <tbody>
Â  Â  Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  </table>
Â  Â  Â  Â Â 
Â  Â  Â  Â  </div>

Â  Â  <script>
// ====== INITIALIZE LOCALSTORAGE DATA MODELS (For testing environment) ======
function initializeLocalStorage() {
Â  Â  if (!localStorage.getItem('vendors')) {
Â  Â  Â  Â  // Sample Approved Vendor for easy testing (Optional)
Â  Â  Â  Â  localStorage.setItem('vendors', JSON.stringify([
Â  Â  Â  Â  Â  Â  { id: 'vendor001', name: 'Test Vendor', whatsapp: '1234567890', password: 'pass', status: 'Approved', promocode: 'VEND001' }
Â  Â  Â  Â  ]));
Â  Â  }
Â  Â  if (!localStorage.getItem('products')) {
Â  Â  Â  Â  localStorage.setItem('products', JSON.stringify([]));
Â  Â  }
Â  Â  if (!localStorage.getItem('orders')) {
Â  Â  Â  Â  localStorage.setItem('orders', JSON.stringify([]));
Â  Â  }
Â  Â  // Master Promo Code List (Admin managed)
Â  Â  if (!localStorage.getItem('masterPromocodes')) {
Â  Â  Â  Â  localStorage.setItem('masterPromocodes', JSON.stringify([
Â  Â  Â  Â  Â  Â  { code: 'FLASH10', discount: 10, type: 'percent', scope: 'global', minOrder: 100, expiry: '2026-01-01' },
Â  Â  Â  Â  Â  Â  { code: 'SAVE25', discount: 25, type: 'percent', scope: 'global', minOrder: 200, expiry: '2026-01-01' },
Â  Â  Â  Â  Â  Â  // Add the sample vendor's unique code
Â  Â  Â  Â  Â  Â  { code: 'VEND001', discount: 15, type: 'percent', scope: 'vendor', vendorId: 'vendor001', minOrder: 50, expiry: '2026-12-31'}
Â  Â  Â  Â  ]));
Â  Â  }
}
initializeLocalStorage();


// ===== GLOBAL STATE & DATA LOAD (Robust Loading) =====
let vendors = [];
let products = [];
let masterPromocodes = [];
let orders = [];
let currentVendor = JSON.parse(localStorage.getItem('currentVendor')||'null');
let editingIndex = null; // Defined globally to be safe

function loadData() {
Â  Â  vendors = JSON.parse(localStorage.getItem("vendors")||'[]');
Â  Â  products = JSON.parse(localStorage.getItem("products")||'[]');
Â  Â  masterPromocodes = JSON.parse(localStorage.getItem("masterPromocodes")||'[]');
Â  Â  orders = JSON.parse(localStorage.getItem("orders")||'[]');
}

// ===== INIT & PAGE SWITCHING (FIXED LOGIC) =====

// ğŸ›‘ FIX: This function fixes the "Cannot read properties of null" error
function showPage(page){
Â  Â  // 1. à¦¸à¦¬ à¦ªà§‡à¦œ à¦²à§à¦•à¦¾à¦¨ (Hide all pages)
Â  Â  document.querySelectorAll('.page').forEach(p=>p.style.display='none');

Â  Â  // 2. à¦Ÿà¦¾à¦°à§à¦—à§‡à¦Ÿ à¦à¦²à¦¿à¦®à§‡à¦¨à§à¦Ÿ à¦§à¦°à§à¦¨
Â  Â  const targetElement = document.getElementById(page+'Page');

Â  Â  // 3. à¦¨à¦¿à¦¶à§à¦šà¦¿à¦¤ à¦•à¦°à§à¦¨ à¦¯à§‡ à¦à¦²à¦¿à¦®à§‡à¦¨à§à¦Ÿà¦Ÿà¦¿ à¦†à¦›à§‡
Â  Â  if (targetElement) {
Â  Â  Â  Â  targetElement.style.display = 'block';

Â  Â  Â  Â  if(page==='dashboard'){
Â  Â  Â  Â  Â  Â  Â if (currentVendor) {
Â  Â  Â  Â  Â  Â  Â  Â  // Dashboard content render
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('vendorName').innerText = currentVendor.name;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('vendorPromoCode').innerText = currentVendor.promocode;
Â  Â  Â  Â  Â  Â  Â  Â  populatePromoDropdown();Â 
Â  Â  Â  Â  Â  Â  Â  Â  renderProducts();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  } else {
Â  Â  Â  Â  console.error(`Error: The page element with ID '${page}Page' was not found in HTML.`);
Â  Â  }
}

function checkLoginStatus() {
Â  Â  loadData(); // Ensure data is loaded
Â  Â  currentVendor = JSON.parse(localStorage.getItem('currentVendor')||'null');
Â  Â Â 
Â  Â  if(currentVendor){Â 
Â  Â  Â  Â  // Re-check if the vendor still exists and is approved before showing dashboard
Â  Â  Â  Â  const existingVendor = vendors.find(v => v.id === currentVendor.id && v.status === 'Approved');
Â  Â  Â  Â  if (existingVendor) {
Â  Â  Â  Â  Â  Â  showPage('dashboard');
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  // If the vendor was logged in but later rejected/deleted by admin
Â  Â  Â  Â  Â  Â  alert("Your account status has changed. Logging out.");
Â  Â  Â  Â  Â  Â  logout();Â 
Â  Â  Â  Â  }
Â  Â  } else {Â 
Â  Â  Â  Â  showPage('login');Â 
Â  Â  }
}

document.addEventListener('DOMContentLoaded', () => {
Â  Â  checkLoginStatus();
});


function showRegister(){Â 
Â  Â  document.getElementById('regMsg').innerText='';
Â  Â  document.getElementById('regName').value='';
Â  Â  document.getElementById('regWhatsapp').value='';
Â  Â  document.getElementById('regPass').value='';
Â  Â  showPage('register');Â 
}

function showLogin(){Â 
Â  Â  document.getElementById('msg').innerText='';
Â  Â  document.getElementById('vendorWhatsappLogin').value='';Â 
Â  Â  document.getElementById('vendorPass').value='';
Â  Â  showPage('login');Â 
}

// ====== AUTH (VENDOR) =====
function vendorRegister(){
Â  Â  loadData();Â 
Â  Â  let name=document.getElementById('regName').value.trim();
Â  Â  let whatsapp=document.getElementById('regWhatsapp').value.trim();
Â  Â  let pass=document.getElementById('regPass').value.trim();
Â  Â  if(!name || !whatsapp || !pass){ document.getElementById('regMsg').innerText='Fill all fields'; return; }
Â  Â Â 
Â  Â  // Check if WhatsApp is already registered
Â  Â  if (vendors.some(v => v.whatsapp === whatsapp)) {
Â  Â  Â  Â  document.getElementById('regMsg').innerText='This WhatsApp number is already registered.'; return;
Â  Â  }

Â  Â  let id = 'vendor'+(vendors.length+1).toString().padStart(3, '0'); // Unique ID format
Â  Â  let uniquePromoCode = 'VEND'+(vendors.length+1).toString().padStart(3, '0');

Â  Â  vendors.push({id,name,whatsapp,password:pass,status:'Pending', promocode: uniquePromoCode});
Â  Â  localStorage.setItem('vendors',JSON.stringify(vendors));

Â  Â  // Also add the vendor-specific promo code to master list
Â  Â  masterPromocodes.push({ code: uniquePromoCode, discount: 15, type: 'percent', scope: 'vendor', vendorId: id, minOrder: 50, expiry: '2026-12-31'});
Â  Â  localStorage.setItem('masterPromocodes',JSON.stringify(masterPromocodes));

Â  Â  document.getElementById('regMsg').innerText=`Registered! Your Vendor ID is ${id}. Status: Pending admin approval.`;
Â  Â Â 
Â  Â  // Clear registration fields only
Â  Â  document.getElementById('regName').value='';
Â  Â  document.getElementById('regWhatsapp').value='';
Â  Â  document.getElementById('regPass').value='';
}

function vendorLogin(){
Â  Â  loadData();Â 
Â  Â  let whatsapp=document.getElementById('vendorWhatsappLogin').value.trim();Â 
Â  Â  let pass=document.getElementById('vendorPass').value.trim();
Â  Â Â 
Â  Â  let v = vendors.find(v => v.whatsapp===whatsapp && v.password===pass);Â 
Â  Â Â 
Â  Â  document.getElementById('msg').innerText='';
Â  Â  if(!v){Â 
Â  Â  Â  Â  document.getElementById('msg').innerText='Invalid WhatsApp Number or password';Â 
Â  Â  Â  Â  return;Â 
Â  Â  }
Â  Â Â 
Â  Â  if(v.status!=='Approved'){Â 
Â  Â  Â  Â  document.getElementById('msg').innerText=`Not approved by admin yet. Current Status: ${v.status}`;Â 
Â  Â  Â  Â  return;Â 
Â  Â  }
Â  Â Â 
Â  Â  currentVendor=v;
Â  Â  localStorage.setItem('currentVendor',JSON.stringify(v));
Â  Â  showPage('dashboard');
}

function logout(){Â 
Â  Â  localStorage.removeItem('currentVendor');Â 
Â  Â  currentVendor=null;Â 
Â  Â  showPage('login');Â 
}

// ====== PROMO CODE UTILITY =====
function populatePromoDropdown() {
Â  Â  loadData();Â 
Â  Â  const select = document.getElementById('prodPromoCode');
Â  Â  select.innerHTML = '<option value="">No Special Promo</option>';

Â  Â  const availablePromos = masterPromocodes.filter(p => p.scope === 'global' || (p.scope === 'vendor' && p.vendorId === currentVendor.id));

Â  Â  availablePromos.forEach(promo => {
Â  Â  Â  Â  const option = document.createElement('option');
Â  Â  Â  Â  option.value = promo.code;
Â  Â  Â  Â  option.innerText = `${promo.code} (${promo.discount}${promo.type === 'percent' ? '%' : '$'})`;
Â  Â  Â  Â  select.appendChild(option);
Â  Â  });
}


// ====== PRODUCTS (CRUD) =====
function generateProductId(){
Â  Â  return products.length>0 ? Math.max(...products.map(p=>p.id))+1 : 1;
}

function resetForm(){
Â  Â  document.getElementById('prodName').value='';
Â  Â  document.getElementById('prodCategory').value='';
Â  Â  document.getElementById('prodPrice').value='';
Â  Â  document.getElementById('prodStock').value='';
Â  Â  document.getElementById('prodImageURL').value='';
Â  Â  document.getElementById('prodPromoCode').value='';Â 
Â  Â Â 
Â  Â  editingIndex=null;
Â  Â  document.getElementById('formTitle').innerText='Add Product';
Â  Â  document.getElementById('addProductBtn').style.display='block';
Â  Â  document.getElementById('updateProductBtn').style.display='none';
Â  Â  document.getElementById('cancelEditBtn').style.display='none';
}

function renderProducts(){
Â  Â  loadData();Â 
Â  Â  const tbody=document.querySelector('#productTable tbody');
Â  Â  tbody.innerHTML='';
Â  Â  const vendorProducts = products.filter(p=>p.vendorId===currentVendor.id);

Â  Â  if(vendorProducts.length===0){ tbody.innerHTML='<tr><td colspan="8">No products added</td></tr>'; return; }

Â  Â  vendorProducts.forEach((p, idx)=>{
Â  Â  Â  Â  const globalIndex = products.findIndex(pr => pr.id === p.id);
Â  Â  Â  Â  let fallbackImage = 'https://via.placeholder.com/50?text=IMG'; // Fallback image if URL is missing/broken
Â  Â  Â  Â  let imageUrlToShow = p.imageURL || fallbackImage; // Ensure imageURL exists

Â  Â  Â  Â  let statusClass = p.status === 'Approved' ? 'status-approved' : 'status-pending';

Â  Â  Â  Â  let tr=document.createElement('tr');
Â  Â  Â  Â  tr.innerHTML=`<td>${p.name}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${p.category}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>$${p.price.toFixed(2)}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${p.stock}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td><img class='product-img' src='${imageUrlToShow}' onerror="this.onerror=null;this.src='${fallbackImage}';" alt='${p.name} image'></td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="${statusClass}">${p.status}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${p.promoCodeAssigned || 'None'}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="update" onclick="editProduct(${globalIndex})">Edit</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="delete" onclick="deleteProduct(${globalIndex})">Delete</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>`;
Â  Â  Â  Â  tbody.appendChild(tr);
Â  Â  });
}

function addProduct(){
Â  Â  loadData();Â 
Â  Â  let name=document.getElementById('prodName').value.trim();
Â  Â  let category=document.getElementById('prodCategory').value.trim();
Â  Â  let price=parseFloat(document.getElementById('prodPrice').value);
Â  Â  let stock=parseInt(document.getElementById('prodStock').value);
Â  Â  // â­ FIX: imageURL à¦ à¦¯à¦¦à¦¿ empty string à¦¥à¦¾à¦•à§‡, à¦¤à¦¬à§‡ à¦¤à¦¾ à¦¸à§‡à¦­ à¦¹à¦¬à§‡ à¦¨à¦¾à¥¤
Â  Â  let imageURL=document.getElementById('prodImageURL').value.trim();Â 
Â  Â  let promoCodeAssigned = document.getElementById('prodPromoCode').value;

Â  Â  if(!name || !category || isNaN(price) || price <= 0 || isNaN(stock) || stock < 0){Â 
Â  Â  Â  Â  alert("Please fill all fields correctly (Price > 0, Stock >= 0)");Â 
Â  Â  Â  Â  return;Â 
Â  Â  }

Â  Â  products.push({
Â  Â  Â  Â  id: generateProductId(),
Â  Â  Â  Â  name,
Â  Â  Â  Â  category,
Â  Â  Â  Â  price,
Â  Â  Â  Â  stock,
Â  Â  Â  Â  imageURL, // à¦à¦–à¦¾à¦¨à§‡ imageURL à¦¸à§‡à¦­ à¦¹à¦¬à§‡ (empty string à¦¬à¦¾ path/url)
Â  Â  Â  Â  vendorId: currentVendor.id,
Â  Â  Â  Â  status:'Pending',Â 
Â  Â  Â  Â  promoCodeAssignedÂ 
Â  Â  });

Â  Â  localStorage.setItem('products',JSON.stringify(products));
Â  Â  renderProducts();Â 
Â  Â  resetForm();
Â  Â  alert('Product added successfully. Waiting for admin approval.');
}


function editProduct(i){
Â  Â  loadData();Â 
Â  Â  editingIndex=i;
Â  Â  let p=products[i];
Â  Â Â 
Â  Â  if(p.vendorId!==currentVendor.id){ alert("Error: Product does not belong to you."); return; }
Â  Â Â 
Â  Â  document.getElementById('prodName').value=p.name;
Â  Â  document.getElementById('prodCategory').value=p.category;
Â  Â  document.getElementById('prodPrice').value=p.price;
Â  Â  document.getElementById('prodStock').value=p.stock;
Â  Â  document.getElementById('prodImageURL').value=p.imageURL; // à¦›à¦¬à¦¿à¦° à¦ªà¦¾à¦¥ à¦²à§‹à¦¡ à¦¹à¦¬à§‡
Â  Â  document.getElementById('prodPromoCode').value=p.promoCodeAssigned || '';Â 

Â  Â  document.getElementById('formTitle').innerText=`Edit Product: ${p.name}`;
Â  Â  document.getElementById('addProductBtn').style.display='none';
Â  Â  document.getElementById('updateProductBtn').style.display='block';
Â  Â  document.getElementById('cancelEditBtn').style.display='inline-block';
}

function updateProduct(){
Â  Â  if(editingIndex===null){ alert("No product selected"); return; }
Â  Â Â 
Â  Â  let name=document.getElementById('prodName').value.trim();
Â  Â  let category=document.getElementById('prodCategory').value.trim();
Â  Â  let price=parseFloat(document.getElementById('prodPrice').value);
Â  Â  let stock=parseInt(document.getElementById('prodStock').value);
Â  Â  // â­ FIX: imageURL à¦ à¦¯à¦¦à¦¿ empty string à¦¥à¦¾à¦•à§‡, à¦¤à¦¬à§‡ à¦¤à¦¾ à¦¸à§‡à¦­ à¦¹à¦¬à§‡ à¦¨à¦¾à¥¤
Â  Â  let imageURL=document.getElementById('prodImageURL').value.trim();
Â  Â  let promoCodeAssigned = document.getElementById('prodPromoCode').value;

Â  Â  if(!name || !category || isNaN(price) || price <= 0 || isNaN(stock) || stock < 0){Â 
Â  Â  Â  Â  alert("Please fill all fields correctly (Price > 0, Stock >= 0)");Â 
Â  Â  Â  Â  return;Â 
Â  Â  }
Â  Â Â 
Â  Â  let p=products[editingIndex];
Â  Â  if(p.vendorId!==currentVendor.id){ alert("Security Error: Not your product"); return; }
Â  Â Â 
Â  Â  p.name=name;Â 
Â  Â  p.category=category;Â 
Â  Â  p.price=price;Â 
Â  Â  p.stock=stock;Â 
Â  Â  p.imageURL=imageURL; // à¦à¦–à¦¾à¦¨à§‡ imageURL à¦¸à§‡à¦­ à¦¹à¦¬à§‡ (empty string à¦¬à¦¾ path/url)
Â  Â  p.promoCodeAssigned = promoCodeAssigned;
Â  Â  p.status='Pending'; // Reset status to Pending after modification
Â  Â Â 
Â  Â  localStorage.setItem('products',JSON.stringify(products));
Â  Â  renderProducts();Â 
Â  Â  resetForm();
Â  Â  alert(`Product updated. Status reset to Pending for admin review.`);
}

function deleteProduct(i){
Â  Â  if(products[i].vendorId!==currentVendor.id){ alert("Error: Not your product"); return; }
Â  Â  if(confirm(`Are you sure you want to delete ${products[i].name}?`)){Â 
Â  Â  Â  Â  products.splice(i,1);Â 
Â  Â  Â  Â  localStorage.setItem('products',JSON.stringify(products));Â 
Â  Â  Â  Â  renderProducts();Â 
Â  Â  Â  Â  resetForm();Â 
Â  Â  }
}
Â  Â  </script>
</body>
</html>
