<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vendor Panel - Dhamaka</title>
<style>
body{font-family:Arial,sans-serif;background:#f8f9fa;color:#212529;margin:0;padding:0;}
header{background:#28a745;color:white;padding:1em;display:flex;justify-content:space-between;align-items:center;}
header h1{margin:0;}
header button{padding:0.5em 1em;border:none;border-radius:5px;background:#ffc107;color:#212529;cursor:pointer;}
.container{padding:1em;}
input,select,textarea{width:100%;padding:0.5em;margin:0.3em 0;border-radius:5px;border:1px solid #ccc;}
button.action-btn{padding:0.5em 1em;margin:0.3em;border:none;border-radius:5px;cursor:pointer; width: 48%;}
button.add{background:#28a745;color:white;}
button.update{background:#007bff;color:white;}
button.delete{background:#dc3545;color:white;width:auto;}
button.cancel{background:#6c757d;color:white;}
table{width:100%;border-collapse:collapse;margin-top:1em;}
table,th,td{border:1px solid #ccc;}
th,td{padding:0.5em;text-align:center;}
.page{display:none;}
img.product-img{width:50px;height:50px;border-radius:5px;object-fit:cover;}
#addProductContainer{max-width:600px;margin:1em auto;padding:1em;border:1px solid #28a745;border-radius:8px;background:#e2f0e6;}
.order{border:1px solid #007bff;border-radius:12px;padding:1em;width:280px;background:#fff;box-shadow:2px2px10px rgba(0,0,0,0.1);}
.order-status-pending{color:orange;font-weight:bold;}
.order-status-shipped{color:blue;font-weight:bold;}
.order-status-delivered{color:green;font-weight:bold;}
</style>
</head>
<body>

<header>
<h1>Vendor Panel</h1>
<div id="headerInfo"></div>
<button onclick="logout()">Logout</button>
</header>

<div class="container">

<div id="loginPage" class="page">
<h2>Vendor Login</h2>
<input type="text" id="vendorId" placeholder="Vendor ID">
<input type="password" id="vendorPass" placeholder="Password">
<button class="add action-btn" onclick="vendorLogin()">Login</button>
<p id="msg" style="color:red;"></p>
</div>

<div id="dashboardPage" class="page">
<h2>Welcome, <span id="vendorName"></span></h2>
<a href="index.html" target="_blank" style="margin-left:15px;color:#28a745;font-weight:bold;">View Shop</a>

<div id="addProductContainer">
<h3 id="formTitle">Add Product</h3>
<input type="hidden" id="editProductId">
<input type="text" id="prodName" placeholder="Product Name">
<input type="text" id="prodCategory" placeholder="Category">
<input type="number" id="prodPrice" placeholder="Price">
<input type="number" id="prodStock" placeholder="Stock Quantity">
<input type="url" id="prodImageURL" placeholder="Product Image URL">
<div id="actionButtons">
<button class="add action-btn" id="addProductBtn" onclick="addProduct()">Add Product</button>
<button class="update action-btn" id="updateProductBtn" style="display:none;" onclick="updateProduct()">Update Product</button>
<button class="cancel action-btn" id="cancelEditBtn" style="display:none;" onclick="resetForm()">Cancel</button>
</div>
</div>

<h3>My Products</h3>
<table id="productTable">
<thead>
<tr>
<th>Name</th>
<th>Category</th>
<th>Price</th>
<th>Stock</th>
<th>Image</th>
<th>Actions</th>
</tr>
</thead>
<tbody></tbody>
</table>

<h3>My Orders</h3>
<div id="vendorOrderList" style="display:flex;flex-wrap:wrap;gap:1em;justify-content:center;margin-top:1em;">
<p>Loading orders...</p>
</div>

</div>
</div>

<script>
// --- Vendors ---
let vendors = JSON.parse(localStorage.getItem("vendors")||'[]');
if(vendors.length===0){
vendors.push({id:'vendor1',password:'1234',name:'Vendor One',status:'Approved'});
vendors.push({id:'vendor2',password:'1234',name:'Vendor Two',status:'Pending'});
localStorage.setItem("vendors",JSON.stringify(vendors));
}

// --- Products & Orders ---
let products = JSON.parse(localStorage.getItem('products')||'[]');
let orders = JSON.parse(localStorage.getItem('orders')||'[]');

// --- Current Vendor ---
let currentVendor = JSON.parse(localStorage.getItem('currentVendor')||'null');

// --- Elements ---
const loginPage = document.getElementById('loginPage');
const dashboardPage = document.getElementById('dashboardPage');
const addProductBtn = document.getElementById('addProductBtn');
const updateProductBtn = document.getElementById('updateProductBtn');
const cancelEditBtn = document.getElementById('cancelEditBtn');
const formTitle = document.getElementById('formTitle');
const vendorOrderList = document.getElementById('vendorOrderList');

if(currentVendor){showPage('dashboard');}else{showPage('login');}

function showPage(page){
loginPage.style.display=(page==='login')?'block':'none';
dashboardPage.style.display=(page==='dashboard')?'block':'none';
if(page==='dashboard'){
reloadVendorData();
renderProducts();
renderVendorOrders();
document.getElementById('vendorName').innerText=currentVendor.name;
resetForm();
}
}

function reloadVendorData(){
products=JSON.parse(localStorage.getItem('products')||'[]');
orders=JSON.parse(localStorage.getItem('orders')||'[]');
}

// --- Auth ---
function vendorLogin(){
let id=document.getElementById('vendorId').value.trim();
let pass=document.getElementById('vendorPass').value.trim();
let v=vendors.find(v=>v.id===id && v.password===pass);
if(v){
if(v.status==='Approved'){
currentVendor=v;
localStorage.setItem('currentVendor',JSON.stringify(v));
showPage('dashboard');
}else{document.getElementById('msg').innerText='Account not approved yet. Contact WhatsApp';}
}else{document.getElementById('msg').innerText='Invalid ID or Password';}
}

function logout(){localStorage.removeItem('currentVendor');currentVendor=null;showPage('login');}

// --- Product CRUD ---
let editingIndex=null;
function generateProductId(){products=JSON.parse(localStorage.getItem('products')||'[]');return products.length>0?Math.max(...products.map(p=>p.id))+1:1;}

function resetForm(){
document.getElementById('prodName').value='';
document.getElementById('prodCategory').value='';
document.getElementById('prodPrice').value='';
document.getElementById('prodStock').value='';
document.getElementById('prodImageURL').value='';
editingIndex=null;
formTitle.innerText='Add Product';
addProductBtn.style.display='block';
updateProductBtn.style.display='none';
cancelEditBtn.style.display='none';
}

function renderProducts(){
reloadVendorData();
let tbody=document.querySelector('#productTable tbody');tbody.innerHTML='';
const vendorProducts=products.filter(p=>p.vendorId===currentVendor.id);
if(vendorProducts.length===0){tbody.innerHTML='<tr><td colspan="6">No products yet.</td></tr>';return;}
vendorProducts.forEach(p=>{
const originalIndex=products.findIndex(prod=>prod.id===p.id);
let tr=document.createElement('tr');
let imgURL=p.imageURL||`https://via.placeholder.com/50?text=${p.name[0]}`;
tr.innerHTML=`<td>${p.name}</td><td>${p.category}</td><td>$${p.price.toFixed(2)}</td><td>${p.stock}</td><td><img class='product-img' src='${imgURL}' alt='${p.name}'></td>
<td><button class="update" onclick="editProduct(${originalIndex})">Edit</button>
<button class="delete" onclick="deleteProduct(${originalIndex})">Delete</button></td>`;
tbody.appendChild(tr);
});
}

function addProduct(){
let name=document.getElementById('prodName').value.trim();
let category=document.getElementById('prodCategory').value.trim();
let price=parseFloat(document.getElementById('prodPrice').value);
let stock=parseInt(document.getElementById('prodStock').value);
let imageURL=document.getElementById('prodImageURL').value.trim();
if(!name||!category||isNaN(price)||price<=0||isNaN(stock)||stock<0||!imageURL){alert("Fill all fields correctly");return;}
const newProduct={id:generateProductId(),name,category,price,stock,rating:5,imageURL,vendorId:currentVendor.id};
products.push(newProduct);
localStorage.setItem('products',JSON.stringify(products));
renderProducts();
resetForm();
}

function editProduct(i){
editingIndex=i;
let p=products[i];
if(p.vendorId!==currentVendor.id){alert("Not your product");return;}
document.getElementById('prodName').value=p.name;
document.getElementById('prodCategory').value=p.category;
document.getElementById('prodPrice').value=p.price;
document.getElementById('prodStock').value=p.stock;
document.getElementById('prodImageURL').value=p.imageURL||'';
formTitle.innerText=`Edit Product: ${p.name}`;
addProductBtn.style.display='none';
updateProductBtn.style.display='block';
cancelEditBtn.style.display='inline-block';
}

function updateProduct(){
if(editingIndex===null){alert("No product selected");return;}
let name=document.getElementById('prodName').value.trim();
let category=document.getElementById('prodCategory').value.trim();
let price=parseFloat(document.getElementById('prodPrice').value);
let stock=parseInt(document.getElementById('prodStock').value);
let imageURL=document.getElementById('prodImageURL').value.trim();
if(!name||!category||isNaN(price)||price<=0||isNaN(stock)||stock<0||!imageURL){alert("Fill all fields correctly");return;}
let p=products[editingIndex];
if(p.vendorId!==currentVendor.id){alert("Not your product");return;}
p.name=name;p.category=category;p.price=price;p.stock=stock;p.imageURL=imageURL;
localStorage.setItem('products',JSON.stringify(products));
alert(`Product ID ${p.id} updated!`);
renderProducts();resetForm();
}

function deleteProduct(i){if(products[i].vendorId!==currentVendor.id){alert("Not your product");return;}if(confirm(`Delete ${products[i].name}?`)){products.splice(i,1);localStorage.setItem('products',JSON.stringify(products));renderProducts();resetForm();}}

// --- Vendor Orders ---
function renderVendorOrders(){
reloadVendorData();vendorOrderList.innerHTML='';
const vendorId=currentVendor.id;let hasOrders=false;
orders.forEach(order=>{
const vendorProductsInOrder=order.products.filter(p=>products.find(mp=>mp.id===p.id && mp.vendorId===vendorId));
if(vendorProductsInOrder.length>0){
hasOrders=true;
let productsStr=vendorProductsInOrder.map(p=>`${p.name} (x${p.quantity})`).join(', ');
const div=document.createElement('div');
div.className='order';div.style.width='280px';
div.innerHTML=`<p><b>Order ID:</b> ${order.id}</p>
<p><b>Customer:</b> ${order.customerName}</p>
<p><b>Your Items:</b> ${productsStr}</p>
<p><b>Total:</b> $${vendorProductsInOrder.reduce((sum,p)=>sum+(p.price*p.quantity),0).toFixed(2)}</p>
<p><b>Status:</b> <span class="order-status-${order.status.toLowerCase()}">${order.status}</span></p>
<p><i>Full order details in Admin Panel.</i></p>`;
vendorOrderList.appendChild(div);
}
});
if(!hasOrders){vendorOrderList.innerHTML='<p style="width:100%;text-align:center;">No orders yet containing your products.</p>';}
}
</script>

</body>
</html>
