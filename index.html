<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dhamaka Daily Items - Shop</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:Arial,sans-serif;background:#f8f9fa;color:#212529;}
header{background:#28a745;color:white;padding:1em;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;}
header h1{font-size:1.5em;}
nav a, nav button{color:white;margin-left:1em;text-decoration:none;font-weight:bold;cursor:pointer;}
.page{display:none;padding:1em;}
.product-list{display:flex;flex-wrap:wrap;gap:1em;justify-content:center;margin-top:1em;}
.product{border:1px solid #28a745;border-radius:12px;padding:1em;width:200px;text-align:center;background:#fff;box-shadow:2px2px10px rgba(0,0,0,0.1);}
.product img{width:150px;height:150px;object-fit:cover;border-radius:8px;}
button{background:#28a745;color:white;border:none;padding:0.5em 1em;border-radius:5px;cursor:pointer;margin-top:0.5em;}
button:disabled{background:#ccc;cursor:not-allowed;}
#cartSummary{text-align:center;margin-top:1em;font-weight:bold;}
</style>
</head>
<body>

<header>
<h1>Dhamaka Daily Items</h1>
<nav>
<a onclick="showPage('home')">Home</a>
<a onclick="showPage('categories')">Categories</a>
<a id="cartLink" onclick="showPage('cart')">Cart (0)</a>
<button id="logoutBtn" style="display:none;" onclick="logout()">Logout</button>
</nav>
</header>

<div id="home" class="page">
<h2>ðŸ”¥ Featured Products</h2>
<div class="product-list" id="homeList"></div>
</div>

<div id="categories" class="page">
<h2>All Products</h2>
<select id="categoryFilter" onchange="filterCategory()"><option value="All">All</option></select>
<input type="text" id="searchInput" placeholder="Search Products..." oninput="filterCategory()">
<div class="product-list" id="categoryList"></div>
</div>

<div id="cart" class="page">
<h2>Your Cart</h2>
<div class="product-list" id="cartList"></div>
<div id="cartSummary"></div>
<button onclick="checkout()">Checkout</button>
</div>

<div id="loginForm" class="page">
<h2>Customer Area</h2>
<div style="text-align:center;margin-bottom:1em;">
<button onclick="toggleAuthForm('login')">Login</button>
<button onclick="toggleAuthForm('register')">Register</button>
</div>
<div id="loginDiv" style="max-width:400px;margin:1em auto;text-align:center;">
<h3>Login</h3>
<input type="text" id="usernameLogin" placeholder="Username">
<input type="password" id="passwordLogin" placeholder="Password">
<button onclick="customerLogin()">Login</button>
<p id="loginMsg" style="color:red;"></p>
</div>
<div id="registerDiv" style="max-width:400px;margin:1em auto;text-align:center;display:none;">
<h3>Register</h3>
<input type="text" id="usernameRegister" placeholder="Username">
<input type="text" id="userWhatsappRegister" placeholder="WhatsApp Number">
<input type="text" id="userAddressRegister" placeholder="Address">
<input type="password" id="passwordRegister" placeholder="Password">
<button onclick="customerRegister()">Register</button>
<p id="registerMsg" style="color:red;"></p>
</div>
</div>

<script>
// ====== Data ======
let products=JSON.parse(localStorage.getItem("products")||'[]');
let vendors=JSON.parse(localStorage.getItem("vendors")||'[]');
let cart=JSON.parse(localStorage.getItem("cart")||'[]');
let customers=JSON.parse(localStorage.getItem("customers")||'[]');
let orders=JSON.parse(localStorage.getItem("orders")||'[]');
let loggedCustomer=JSON.parse(localStorage.getItem("loggedCustomer")||'null');

// ====== Auth ======
if(loggedCustomer){ showPage('home'); document.getElementById('logoutBtn').style.display='inline-block'; } 
else{ showPage('loginForm'); }

function toggleAuthForm(mode){
const login=document.getElementById('loginDiv');
const register=document.getElementById('registerDiv');
if(mode==='login'){ login.style.display='block'; register.style.display='none'; }
else{ login.style.display='none'; register.style.display='block'; }
}

function customerRegister(){
let username=document.getElementById("usernameRegister").value.trim();
let whatsapp=document.getElementById("userWhatsappRegister").value.trim();
let address=document.getElementById("userAddressRegister").value.trim();
let password=document.getElementById("passwordRegister").value;
if(!username||!whatsapp||!address||!password){ document.getElementById("registerMsg").innerText="Fill all fields"; return; }
if(customers.some(c=>c.username===username)){ document.getElementById("registerMsg").innerText="Username exists"; return; }
customers.push({username,whatsapp,address,password});
localStorage.setItem("customers",JSON.stringify(customers));
document.getElementById("registerMsg").innerText="Registered! Login now"; toggleAuthForm('login');
}

function customerLogin(){
let username=document.getElementById("usernameLogin").value.trim();
let password=document.getElementById("passwordLogin").value.trim();
let user=customers.find(c=>c.username===username && c.password===password);
if(user){ loggedCustomer=user; localStorage.setItem("loggedCustomer",JSON.stringify(loggedCustomer));
showPage('home'); document.getElementById('logoutBtn').style.display='inline-block';
document.getElementById("loginMsg").innerText="";
document.getElementById("usernameLogin").value=''; document.getElementById("passwordLogin").value=''; }
else{ document.getElementById("loginMsg").innerText="Invalid credentials"; }
}

function logout(){ loggedCustomer=null; localStorage.removeItem("loggedCustomer"); showPage('loginForm'); document.getElementById('logoutBtn').style.display='none'; }

// ====== Render Products ======
const homeList=document.getElementById("homeList");
const categoryList=document.getElementById("categoryList");
const cartList=document.getElementById("cartList");
const cartLink=document.getElementById("cartLink");
function renderProducts(list,arr){
list.innerHTML='';
if(arr.length===0){ list.innerHTML="<p>No products.</p>"; return; }
arr.forEach(p=>{
if(!p.approved) return; // Only approved products
const vendor=p.vendorId?vendors.find(v=>v.id===p.vendorId):null;
const div=document.createElement('div'); div.className='product';
const image=p.imageURL?p.imageURL:p.image?p.image:"https://via.placeholder.com/150";
div.innerHTML=`<img src="${image}" alt="${p.name}"><h3>${p.name}</h3>
<p>Price: $${p.price.toFixed(2)}</p><p>Stock: ${p.stock}</p>
<button ${p.stock<=0?'disabled':''} onclick="addToCart(${p.id})">${p.stock>0?'Add to Cart':'Out of Stock'}</button>`;
list.appendChild(div);
});
updateCartBadge();
}

// ====== Home & Categories ======
function showPage(page){
document.querySelectorAll('.page').forEach(p=>p.style.display='none');
document.getElementById(page).style.display='block';
renderAllContent();
}

function renderAllContent(){
renderProducts(homeList,products.slice(0,6));
populateCategoryFilter(); filterCategory(); renderCart();
}

function populateCategoryFilter(){
const categories=[...new Set(products.filter(p=>p.approved).map(p=>p.category))];
const filter=document.getElementById('categoryFilter'); filter.innerHTML='<option value="All">All</option>';
categories.forEach(c=>{ let opt=document.createElement('option'); opt.value=c; opt.textContent=c; filter.appendChild(opt); });
}

function filterCategory(){
let filtered=products.filter(p=>p.approved);
const cat=document.getElementById('categoryFilter').value;
const term=document.getElementById('searchInput').value.toLowerCase();
if(cat!=='All'){ filtered=filtered.filter(p=>p.category===cat); }
if(term){ filtered=filtered.filter(p=>p.name.toLowerCase().includes(term)); }
renderProducts(categoryList,filtered);
}

// ====== Cart ======
function addToCart(productId){
if(!loggedCustomer){ alert("Login first!"); showPage('loginForm'); toggleAuthForm('login'); return; }
const product=products.find(p=>p.id===productId); if(!product||product.stock<1){ alert("Out of stock"); return; }
const item=cart.find(c=>c.id===productId);
if(item){ if(item.quantity>=product.stock){ alert(`Max stock ${product.stock}`); return; } item.quantity++; }
else{ cart.push({...product,quantity:1}); }
localStorage.setItem("cart",JSON.stringify(cart)); renderCart(); alert(`${product.name} added!`);
}

function renderCart(){
cartList.innerHTML=''; if(cart.length===0){ cartList.innerHTML="<p>Cart is empty</p>"; updateCartBadge(); return; }
cart.forEach((p,i)=>{
const div=document.createElement('div'); div.className='product';
div.innerHTML=`<p>${p.name} x ${p.quantity} - $${(p.price*p.quantity).toFixed(2)}</p>
<input type="number" value="${p.quantity}" min="1" onchange="updateQuantity(${i},this.value)">
<button onclick="removeFromCart(${i})">Remove</button>`;
cartList.appendChild(div);
}); updateCartTotal(); updateCartBadge();
}

function updateQuantity(i,val){
const quantity=Number(val); if(quantity<1||isNaN(quantity)) return;
const productInStock=products.find(p=>p.id===cart[i].id);
if(productInStock && quantity>productInStock.stock){ alert(`Max stock ${productInStock.stock}`); cart[i].quantity=productInStock.stock; }
else{ cart[i].quantity=quantity; }
localStorage.setItem("cart",JSON.stringify(cart)); renderCart(); updateCartTotal();
}

function removeFromCart(i){ cart.splice(i,1); localStorage.setItem("cart",JSON.stringify(cart)); renderCart(); }

function updateCartTotal(){ let total=0; cart.forEach(p=>{ total+=p.price*(p.quantity||1); }); document.getElementById('cartSummary').innerText=`Total: $${total.toFixed(2)}`; }

function updateCartBadge(){ cartLink.innerText=`Cart (${cart.length})`; }

function checkout(){
if(cart.length===0){ alert("Cart empty!"); return; }
let total=cart.reduce((sum,p)=>sum+p.price*(p.quantity||1),0);
// Update stock & vendor promo count
cart.forEach(item=>{
const prodIndex=products.findIndex(p=>p.id===item.id); if(prodIndex!==-1){ products[prodIndex].stock-=item.quantity; }
const vendor=vendors.find(v=>v.id===item.vendorId); if(vendor){ vendor.customers=vendor.customers?vendor.customers+1:1; }
});
localStorage.setItem("products",JSON.stringify(products));
localStorage.setItem("vendors",JSON.stringify(vendors));
orders.push({id:orders.length+1,customerName:loggedCustomer.username,products:cart,total:total.toFixed(2),status:'Pending'});
localStorage.setItem("orders",JSON.stringify(orders));
cart=[]; localStorage.setItem("cart",JSON.stringify(cart));
alert(`Order placed! Total: $${total.toFixed(2)}`);
showPage('home'); renderAllContent();
}
</script>
</body>
</html>
