<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel - Dhamaka Daily Items</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:Arial,sans-serif;background:#f1f1f1;color:#212529;}
header{background:#343a40;color:white;padding:1em;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;}
header h1{font-size:1.5em;}
nav button{margin-left:1em;cursor:pointer;padding:0.3em 0.7em;border-radius:5px;border:none;color:white;background:#17a2b8;}
nav button:hover{background:#138496;}
.page{display:none;padding:1em;}
table{width:100%;border-collapse:collapse;margin-top:1em;}
th,td{border:1px solid #ccc;padding:0.5em;text-align:center;}
button.action{padding:0.3em 0.7em;margin:0.2em;border:none;border-radius:5px;cursor:pointer;}
button.approve{background:#28a745;color:white;}
button.reject{background:#dc3545;color:white;}
</style>
</head>
<body>

<header>
<h1>Admin Panel</h1>
<nav>
<button onclick="logout()">Logout</button>
</nav>
</header>

<div id="adminLogin" class="page">
<h2>Admin Login</h2>
<input type="text" id="adminUsername" placeholder="Username">
<input type="password" id="adminPassword" placeholder="Password">
<button onclick="adminLogin()">Login</button>
<p id="adminLoginMsg" style="color:red;"></p>
</div>

<div id="adminDashboard" class="page">
<h2>Welcome, Admin</h2>

<h3>Vendors Pending Approval</h3>
<table id="vendorTable">
<thead>
<tr><th>Name</th><th>Promo Code</th><th>Status</th><th>Actions</th></tr>
</thead>
<tbody></tbody>
</table>

<h3>Products Pending Approval</h3>
<table id="productTable">
<thead>
<tr><th>Name</th><th>Vendor</th><th>Price</th><th>Stock</th><th>Status</th><th>Actions</th></tr>
</thead>
<tbody></tbody>
</table>

<h3>Vendor Promo Stats</h3>
<table id="promoTable">
<thead>
<tr><th>Vendor</th><th>Promo Code</th><th>Customers</th></tr>
</thead>
<tbody></tbody>
</table>

<h3>Orders</h3>
<table id="orderTable">
<thead>
<tr><th>Order ID</th><th>Customer</th><th>Vendor Products</th><th>Total</th><th>Status</th></tr>
</thead>
<tbody></tbody>
</table>
</div>

<script>
// ====== Data ======
let adminUser={username:"admin",password:"admin123"};
let vendors=JSON.parse(localStorage.getItem("vendors")||'[]');
let products=JSON.parse(localStorage.getItem("products")||'[]');
let orders=JSON.parse(localStorage.getItem("orders")||'[]');
let loggedAdmin=JSON.parse(localStorage.getItem("loggedAdmin")||'null');

if(loggedAdmin){ showPage('adminDashboard'); renderAdminData(); }
else{ showPage('adminLogin'); }

// ====== Auth ======
function adminLogin(){
let u=document.getElementById("adminUsername").value.trim();
let p=document.getElementById("adminPassword").value.trim();
if(u===adminUser.username && p===adminUser.password){
loggedAdmin=true; localStorage.setItem("loggedAdmin",JSON.stringify(loggedAdmin));
showPage('adminDashboard'); renderAdminData();
}else{ document.getElementById("adminLoginMsg").innerText="Invalid credentials"; }
}
function logout(){ loggedAdmin=null; localStorage.removeItem("loggedAdmin"); showPage('adminLogin'); }

// ====== Page Control ======
function showPage(page){ document.querySelectorAll('.page').forEach(p=>p.style.display='none'); document.getElementById(page).style.display='block'; }

// ====== Vendors ======
function renderAdminData(){
renderVendors(); renderProducts(); renderPromoStats(); renderOrders();
}

function renderVendors(){
const tbody=document.querySelector("#vendorTable tbody"); tbody.innerHTML='';
vendors.forEach((v,i)=>{
const tr=document.createElement('tr');
tr.innerHTML=`<td>${v.name}</td>
<td>${v.promoCode}</td>
<td>${v.approved?'Approved':'Pending'}</td>
<td>${v.approved?'':'<button class="approve" onclick="approveVendor(${i})">Approve</button><button class="reject" onclick="rejectVendor(${i})">Reject</button>'}</td>`;
tbody.appendChild(tr);
});
}

function approveVendor(i){ vendors[i].approved=true; localStorage.setItem("vendors",JSON.stringify(vendors)); renderVendors(); }
function rejectVendor(i){ vendors.splice(i,1); localStorage.setItem("vendors",JSON.stringify(vendors)); renderVendors(); }

// ====== Products ======
function renderProducts(){
const tbody=document.querySelector("#productTable tbody"); tbody.innerHTML='';
products.forEach((p,i)=>{
const vendorName=(vendors.find(v=>v.id===p.vendorId)||{}).name||'Unknown';
const tr=document.createElement('tr');
tr.innerHTML=`<td>${p.name}</td>
<td>${vendorName}</td>
<td>$${p.price}</td>
<td>${p.stock}</td>
<td>${p.approved?'Approved':'Pending'}</td>
<td>${p.approved?'':'<button class="approve" onclick="approveProduct(${i})">Approve</button><button class="reject" onclick="rejectProduct(${i})">Reject</button>'}</td>`;
tbody.appendChild(tr);
});
}

function approveProduct(i){ products[i].approved=true; localStorage.setItem("products",JSON.stringify(products)); renderProducts(); }
function rejectProduct(i){ products.splice(i,1); localStorage.setItem("products",JSON.stringify(products)); renderProducts(); }

// ====== Promo Stats ======
function renderPromoStats(){
const tbody=document.querySelector("#promoTable tbody"); tbody.innerHTML='';
vendors.forEach(v=>{
const tr=document.createElement('tr');
tr.innerHTML=`<td>${v.name}</td><td>${v.promoCode}</td><td>${v.customers||0}</td>`;
tbody.appendChild(tr);
});
}

// ====== Orders ======
function renderOrders(){
const tbody=document.querySelector("#orderTable tbody"); tbody.innerHTML='';
orders.forEach(o=>{
const vendorProducts=o.products.filter(p=>vendors.some(v=>v.id===p.vendorId)).map(p=>p.name+" x"+p.quantity).join(", ");
const tr=document.createElement('tr');
tr.innerHTML=`<td>${o.id}</td><td>${o.customerName}</td><td>${vendorProducts}</td><td>$${o.total}</td><td>${o.status}</td>`;
tbody.appendChild(tr);
});
}
</script>
</body>
</html>
