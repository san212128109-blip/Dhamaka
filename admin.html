<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dhamaka Admin Panel</title>
<style>
/* CSS: ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶™‡ßÅ‡¶∞‡ßã‡¶®‡ßã ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ ‡¶Ö‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶ø‡¶§ ‡¶Ü‡¶õ‡ßá */
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:Arial,sans-serif;background:#f8f9fa;color:#333;transition:0.3s;}
body.dark{background:#121212;color:#ddd;}
header{background:#28a745;color:white;padding:1em;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:10;flex-wrap:wrap;}
header h1{margin:0;font-size:1.5em;}
nav a{color:white;margin-left:1em;text-decoration:none;font-weight:bold;transition:0.3s;}
nav a:hover{text-decoration:underline;color:#ffc107;}
nav button{margin-left:1em;cursor:pointer;}
.page{display:none;padding:1em;}
h2, h3 {text-align: center; margin-bottom: 0.5em;}
.product-list,.vendor-list,.review-list,.order-list{display:flex;flex-wrap:wrap;gap:1em;justify-content:center;margin-top:1em;}
.product,.vendor,.review,.order{border:1px solid #28a745;border-radius:12px;padding:1em;width:280px;text-align:center;background:#fff;box-shadow:2px2px10px rgba(0,0,0,0.1);transition:0.3s;position:relative;overflow:hidden;}
.product:hover,.vendor:hover,.review:hover,.order:hover{transform:scale(1.05);box-shadow:4px4px15px rgba(0,0,0,0.2);}
.product img{width:100px; height:100px; object-fit:cover; margin-bottom:10px; border-radius:8px;} /* Added for product list image */
button{background:#28a745;color:white;border:none;padding:0.5em 1em;border-radius:5px;cursor:pointer;margin-top:0.5em;transition:0.3s;}
button:hover{background:#218838;}
input,select{padding:0.5em;margin:0.3em 0;width:90%;border-radius:5px;border:1px solid #ccc;}
.order-status-pending {color: orange; font-weight: bold;}
.order-status-shipped {color: blue; font-weight: bold;}
.order-status-delivered {color: green; font-weight: bold;}
.edit-input {width: 45%; margin: 0.2em 2%; padding: 0.3em;}
</style>
</head>
<body>

<header>
<h1>Dhamaka Admin Panel</h1>
<nav>
<a href="#dashboard" onclick="showPage('dashboard')">Dashboard</a>
<a href="#products" onclick="showPage('products')">Products</a>
<a href="#reviews" onclick="showPage('reviews')">Reviews</a>
<a href="#orders" onclick="showPage('orders')">Orders</a>
<a href="vendor.html" target="_blank">Vendor Panel</a> 
<a href="index.html" target="_blank">View Shop</a>
<button onclick="toggleDarkMode()">üåô</button>
</nav>
</header>

<div id="loginPage" class="page">
<h2>Admin Login</h2>
<input type="password" id="adminPassword" placeholder="Enter Password">
<button onclick="adminLogin()">Login</button>
<p id="loginMsg" style="color:red"></p>
</div>

<div id="dashboard" class="page">
<h2>Dashboard</h2>
<p>Welcome, Admin!</p>
<h3>Theme Customization</h3>
<div style="max-width: 400px; margin: 0 auto; padding: 1em; border: 1px solid #ccc; border-radius: 8px;">
    <label style="display: block;">Background Color: <input type="color" id="bgColor" onchange="applyTheme()"></label>
    <label style="display: block;">Text Color: <input type="color" id="textColor" onchange="applyTheme()"></label>
    <label style="display: block;">Button Color: <input type="color" id="btnColor" onchange="applyTheme()"></label>
    <label style="display: block;">Button Text Color: <input type="color" id="btnTextColor" onchange="applyTheme()"></label>
</div>
</div>

<div id="products" class="page">
    <h2>Products Management</h2>
    
    <div id="addProductContainer" style="max-width:600px; margin:1em auto; border:1px solid #28a745; padding:1em; border-radius:12px; background:#e2f0e6;">
        <h3>‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶£‡ßç‡¶Ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶® (Add New Product)</h3>
        <input type="text" id="pName" placeholder="Product Name (‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ)">
        <select id="pCategory">
            <option value="Electronics">Electronics</option>
            <option value="Apparel">Apparel</option>
            <option value="Furniture">Furniture</option>
            <option value="Groceries">Groceries</option>
            <option value="Other">Other</option>
        </select>
        <input type="number" id="pPrice" placeholder="Price (‡¶¶‡¶æ‡¶Æ)">
        <input type="number" id="pStock" placeholder="Stock (‡¶∏‡ßç‡¶ü‡¶ï)">
        <input type="text" id="pBadge" placeholder="Badge (‡¶Ø‡ßá‡¶Æ‡¶®: New, Sale) (Optional)">
        <input type="url" id="pImageURL" placeholder="Image URL (‡¶õ‡¶¨‡¶ø‡¶∞ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï)"> 
        <button onclick="addProduct()">‡¶™‡¶£‡ßç‡¶Ø‡¶ü‡¶ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶® (Add Product)</button>
    </div>
    
    <div class="product-list" id="productList"></div>
</div>

<div id="reviews" class="page">
    <h2>Customer Reviews</h2>
    <div class="review-list" id="reviewList"></div>
</div>

<div id="orders" class="page">
    <h2>Orders</h2>
    <div style="text-align: center; margin-bottom: 1em;">
        <select id="orderStatusFilter" onchange="renderOrders()">
            <option value="All">Filter by Status (All)</option>
            <option value="Pending">Pending</option>
            <option value="Shipped">Shipped</option>
            <option value="Delivered">Delivered</option>
        </select>
    </div>
    <div class="order-list" id="orderList"></div>
</div>

<script>
// ===== DATA (Reloading from Local Storage is crucial for synchronization) =====
let adminLoggedIn=false;
let products=JSON.parse(localStorage.getItem('products')||'[]');
let reviews=JSON.parse(localStorage.getItem('reviews')||'[]');
let orders=JSON.parse(localStorage.getItem('orders')||'[]');

// ===== PAGE CONTROL & LOGIN =====
function reloadData() {
    products = JSON.parse(localStorage.getItem('products')||'[]');
    reviews = JSON.parse(localStorage.getItem('reviews')||'[]');
    orders = JSON.parse(localStorage.getItem('orders')||'[]');
}

function showPage(page){
    if(!adminLoggedIn && page!=='loginPage'){alert('Login required'); return;}
    document.querySelectorAll('.page').forEach(p=>p.style.display='none');
    document.getElementById(page).style.display='block';
    reloadData(); // Always reload data before rendering
    renderAll();
}
showPage('loginPage');

function adminLogin(){
    let pass=document.getElementById('adminPassword').value;
    if(pass==='NAFIS128'){ // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°
        adminLoggedIn=true;
        showPage('dashboard');
    }else{
        document.getElementById('loginMsg').innerText='Wrong Password';
    }
}
function toggleDarkMode(){ document.body.classList.toggle('dark'); }
function applyTheme(){
    document.body.style.background=document.getElementById('bgColor').value;
    document.body.style.color=document.getElementById('textColor').value;
    document.querySelectorAll('button').forEach(b=>{
        b.style.background=document.getElementById('btnColor').value;
        b.style.color=document.getElementById('btnTextColor').value;
    });
}
function renderAll(){ renderProducts(); renderReviews(); renderOrders(); }

// ===== PRODUCTS MANAGEMENT (‡¶Ø‡ßã‡¶ó, ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶è‡¶¨‡¶Ç ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ) =====

function generateProductId() {
    // ‡¶â‡¶ö‡ßç‡¶ö‡¶§‡¶Æ ID ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶§‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá 1 ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ
    products = JSON.parse(localStorage.getItem('products')||'[]'); // Ensure latest product list
    return products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1;
}

function addProduct() {
    const name = document.getElementById('pName').value;
    const category = document.getElementById('pCategory').value;
    const price = Number(document.getElementById('pPrice').value);
    const stock = Number(document.getElementById('pStock').value);
    const badge = document.getElementById('pBadge').value || null;
    const imageURL = document.getElementById('pImageURL').value; 

    if (!name || !price || !stock || !imageURL || price <= 0 || stock < 0){ 
        alert("‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶∏‡¶†‡¶ø‡¶ï ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶® (‡¶®‡¶æ‡¶Æ, ‡¶¶‡¶æ‡¶Æ > 0, ‡¶∏‡ßç‡¶ü‡¶ï ‚â• 0, ‡¶è‡¶¨‡¶Ç ‡¶õ‡¶¨‡¶ø‡¶∞ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï)‡•§"); 
        return; 
    }
    
    const newProduct = {
        id: generateProductId(),
        name: name,
        category: category,
        price: price,
        stock: stock,
        rating: 5, 
        badge: badge,
        imageURL: imageURL, // Use imageURL for consistency with vendor.html
        vendorId: 'admin' // Identify products added by admin
    };

    products = JSON.parse(localStorage.getItem('products')||'[]'); // Reload before push
    products.push(newProduct);
    localStorage.setItem('products', JSON.stringify(products));
    
    // ‡¶´‡¶∞‡ßç‡¶Æ ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶ï‡¶∞‡¶æ
    document.getElementById('pName').value = '';
    document.getElementById('pPrice').value = '';
    document.getElementById('pStock').value = '';
    document.getElementById('pBadge').value = '';
    document.getElementById('pImageURL').value = '';
    
    alert(`‡¶™‡¶£‡ßç‡¶Ø "${name}" ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!`);
    renderProducts();
}

function renderProducts(){
    // ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶Ø‡ßá ‡¶°‡ßá‡¶ü‡¶æ store ‡¶•‡ßá‡¶ï‡ßá ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá
    products=JSON.parse(localStorage.getItem('products')||'[]');
    
    let list=document.getElementById('productList'); list.innerHTML='';
    if(products.length===0){list.innerHTML='<p>‡¶ï‡ßã‡¶®‡ßã ‡¶™‡¶£‡ßç‡¶Ø ‡¶®‡ßá‡¶á</p>'; return;}
    
    products.forEach((p,i)=>{
        let div=document.createElement('div'); div.className='product';
        // Use p.imageURL if available, otherwise use a placeholder
        const imageUrl = p.imageURL || (p.image && p.image.startsWith('http') ? p.image : "https://via.placeholder.com/100?text=No+Image");

        div.innerHTML=`
        <img src="${imageUrl}" alt="${p.name}">
        <h3>${p.name} (ID: ${p.id})</h3>
        <p>Category: ${p.category}</p>
        <p>Vendor: ${p.vendorId || 'Admin/Initial'}</p>
        <p>Current Price: $${p.price.toFixed(2)}</p>
        <p>Current Stock: ${p.stock}</p>
        
        <input type="number" id="priceEdit${p.id}" value="${p.price}" class="edit-input" placeholder="New Price">
        <input type="number" id="stockEdit${p.id}" value="${p.stock}" class="edit-input" placeholder="New Stock">
        
        <button onclick="editProduct(${p.id})">Update Price/Stock</button>
        <button onclick="deleteProduct(${i})" style="background: red;">‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡ßÅ‡¶® (Delete)</button>`;
        list.appendChild(div);
    });
}

function editProduct(productId) {
    const newPrice = Number(document.getElementById(`priceEdit${productId}`).value);
    const newStock = Number(document.getElementById(`stockEdit${productId}`).value);

    if (isNaN(newPrice) || newPrice <= 0 || isNaN(newStock) || newStock < 0) {
        alert("‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶∏‡¶†‡¶ø‡¶ï ‡¶¶‡¶æ‡¶Æ (> 0) ‡¶è‡¶¨‡¶Ç ‡¶∏‡ßç‡¶ü‡¶ï (‚â• 0) ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§");
        return;
    }
    
    products = JSON.parse(localStorage.getItem('products')||'[]'); // Reload before updating
    const index = products.findIndex(p => p.id === productId);
    if (index !== -1) {
        products[index].price = newPrice;
        products[index].stock = newStock;
        localStorage.setItem('products', JSON.stringify(products));
        alert(`‡¶™‡¶£‡ßç‡¶Ø ID ${productId} ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`);
        renderProducts();
    }
}

function deleteProduct(i){
    products = JSON.parse(localStorage.getItem('products')||'[]'); // Reload before deleting
    if(confirm(`‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶Ø‡ßá ‡¶™‡¶£‡ßç‡¶Ø‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶¨‡ßá‡¶®: ${products[i].name}?`)){
        products.splice(i,1); 
        localStorage.setItem('products',JSON.stringify(products)); 
        renderProducts();
    }
}

// ===== REVIEWS (‡¶Ö‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶ø‡¶§) =====
function renderReviews(){
    reviews=JSON.parse(localStorage.getItem('reviews')||'[]');
    let list=document.getElementById('reviewList'); list.innerHTML='';
    if(reviews.length===0){list.innerHTML='<p>No reviews</p>'; return;}
    reviews.forEach((r,i)=>{
        let div=document.createElement('div'); div.className='review';
        div.innerHTML=`<p><b>${r.name||r.customer}</b>: ${r.text}</p>
        <button onclick="deleteReview(${i})" style="background: red;">Delete</button>`;
        list.appendChild(div);
    });
}
function deleteReview(i){reviews=JSON.parse(localStorage.getItem('reviews')||'[]'); reviews.splice(i,1); localStorage.setItem('reviews',JSON.stringify(reviews)); renderReviews();}

// ===== ORDERS (‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá) =====
function renderOrders(){
    orders=JSON.parse(localStorage.getItem('orders')||'[]');
    let list=document.getElementById('orderList'); list.innerHTML='';
    
    const filterStatus = document.getElementById('orderStatusFilter').value;
    let filteredOrders = orders;

    if (filterStatus !== 'All') {
        filteredOrders = orders.filter(o => o.status === filterStatus);
    }
    
    // Sort by Pending first, then Shipped, then Delivered (or by date if all same status)
    filteredOrders.sort((a, b) => {
        const statusOrder = { "Pending": 1, "Shipped": 2, "Delivered": 3 };
        return statusOrder[a.status] - statusOrder[b.status];
    });

    if(filteredOrders.length===0){ list.innerHTML='<p>No orders yet for this status.</p>'; return;}
    
    filteredOrders.forEach((o,i)=>{
        // Original index needed to update/delete
        const originalIndex = orders.findIndex(item => item.id === o.id);

        let productsStr=o.products.map(p=>`${p.name} (x${p.quantity})`).join(', ');
        
        let statusClass = `order-status-${o.status.toLowerCase()}`;
        
        let div=document.createElement('div'); div.className='order';
        div.innerHTML=`
            <p><b>Order ID:</b> ${o.id}</p>
            <p><b>Customer:</b> ${o.customerName}</p>
            <p><b>WhatsApp:</b> ${o.customerWhatsapp}</p>
            <p><b>Address:</b> ${o.customerAddress}</p>
            <p><b>Products:</b> ${productsStr}</p>
            <p><b>Total:</b> $${o.total}</p>
            <p><b>Date:</b> ${o.date}</p>
            <p><b>Current Status:</b> <span class="${statusClass}">${o.status}</span></p>
            
            <select onchange="updateOrderStatus(${originalIndex}, this.value)">
                <option value="${o.status}">${o.status} (Select New)</option>
                <option value="Pending">Pending</option>
                <option value="Shipped">Shipped</option>
                <option value="Delivered">Delivered</option>
            </select>
            
            <button onclick="deleteOrder(${originalIndex})" style="background: red;">Delete Order</button>`;
        list.appendChild(div);
    });
}

function updateOrderStatus(i, newStatus) {
    orders=JSON.parse(localStorage.getItem('orders')||'[]'); // Reload before updating
    if (orders[i].status === newStatus) return; // No change

    orders[i].status = newStatus;
    localStorage.setItem('orders', JSON.stringify(orders));
    alert(`Order ID ${orders[i].id} status updated to ${newStatus}`);
    renderOrders(); // Re-render to show updated status
}

function deleteOrder(i){
    orders=JSON.parse(localStorage.getItem('orders')||'[]'); // Reload before deleting
    if(confirm(`‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶Ø‡ßá ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ID ${orders[i].id} ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶¨‡ßá‡¶®?`)){
        orders.splice(i,1); 
        localStorage.setItem('orders',JSON.stringify(orders)); 
        renderOrders();
    }
}
</script>
</body>
</html>
