<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel</title>
<style>
body{font-family:Arial,sans-serif;background:#f0f2f5;margin:0;padding:0;}
header{background:#28a745;color:white;padding:1em;text-align:center;}
h2{margin-top:1em;}
.container{display:flex;flex-wrap:wrap;gap:1em;padding:1em;}
.box{background:white;padding:1em;border-radius:10px;flex:1;min-width:300px;box-shadow:0 0 5px rgba(0,0,0,0.2);}
button{padding:0.3em 0.6em;margin:0.2em;cursor:pointer;}
table{width:100%;border-collapse:collapse;margin-top:0.5em;}
th,td{border:1px solid #ccc;padding:0.5em;text-align:left;}
.approve{background:#28a745;color:white;border:none;border-radius:5px;}
.deny{background:#dc3545;color:white;border:none;border-radius:5px;}
</style>
</head>
<body>

<header>
<h1>Admin Panel</h1>
<p>Admin Password: <input type="password" id="adminPass"><button onclick="loginAdmin()">Login</button></p>
</header>

<div id="adminPanel" style="display:none;">

<div class="container">
  <!-- Vendor Management -->
  <div class="box">
    <h2>Vendors</h2>
    <table id="vendorTable">
      <thead>
        <tr><th>Vendor ID</th><th>Name</th><th>Trial End</th><th>Actions</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Pending Product Approvals -->
  <div class="box">
    <h2>Pending Products</h2>
    <table id="productTable">
      <thead>
        <tr><th>Vendor</th><th>Product</th><th>Category</th><th>Price</th><th>Stock</th><th>Actions</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

</div>

<script>
// Admin password
const ADMIN_PASS = "NAFIS128";

let vendors = JSON.parse(localStorage.getItem("vendors")||'[]');
let pendingProducts = JSON.parse(localStorage.getItem("pendingProducts")||'[]');
let approvedProducts = JSON.parse(localStorage.getItem("approvedProducts")||'[]');

function loginAdmin(){
  let pass = document.getElementById("adminPass").value;
  if(pass===ADMIN_PASS){
    document.getElementById("adminPanel").style.display="block";
    renderVendors();
    renderPendingProducts();
  }else{
    alert("Wrong password");
  }
}

// Render vendors
function renderVendors(){
  let tbody=document.querySelector("#vendorTable tbody");
  tbody.innerHTML='';
  vendors.forEach(v=>{
    let trialEnd = new Date(v.startDate||Date.now()+0);
    trialEnd.setDate(trialEnd.getDate()+7);
    let tr=document.createElement("tr");
    tr.innerHTML=`<td>${v.id}</td><td>${v.name}</td><td>${trialEnd.toLocaleDateString()}</td>
    <td>
      <button class="approve" onclick="approveVendor('${v.id}')">Approve</button>
      <button class="deny" onclick="denyVendor('${v.id}')">Deny</button>
    </td>`;
    tbody.appendChild(tr);
  });
}

function approveVendor(id){
  alert(`Vendor ${id} approved! Contact via WhatsApp: 10913821910`);
  // Set startDate for trial
  vendors = vendors.map(v=>v.id===id?{...v,startDate:Date.now()}:v);
  localStorage.setItem("vendors",JSON.stringify(vendors));
  renderVendors();
}

function denyVendor(id){
  if(confirm(`Deny vendor ${id}?`)){
    vendors = vendors.filter(v=>v.id!==id);
    localStorage.setItem("vendors",JSON.stringify(vendors));
    renderVendors();
  }
}

// Render pending products
function renderPendingProducts(){
  let tbody=document.querySelector("#productTable tbody");
  tbody.innerHTML='';
  pendingProducts.forEach((p,i)=>{
    let tr=document.createElement("tr");
    tr.innerHTML=`<td>${p.vendorID}</td><td>${p.name}</td><td>${p.category}</td><td>${p.price}</td><td>${p.stock}</td>
    <td>
      <button class="approve" onclick="approveProduct(${i})">Approve</button>
      <button class="deny" onclick="denyProduct(${i})">Deny</button>
    </td>`;
    tbody.appendChild(tr);
  });
}

function approveProduct(index){
  let product = pendingProducts.splice(index,1)[0];
  approvedProducts.push(product);
  localStorage.setItem("approvedProducts",JSON.stringify(approvedProducts));
  localStorage.setItem("pendingProducts",JSON.stringify(pendingProducts));
  renderPendingProducts();
  alert(`Product ${product.name} approved!`);
}

function denyProduct(index){
  if(confirm("Are you sure to deny this product?")){
    pendingProducts.splice(index,1);
    localStorage.setItem("pendingProducts",JSON.stringify(pendingProducts));
    renderPendingProducts();
  }
}
</script>

</body>
</html>
