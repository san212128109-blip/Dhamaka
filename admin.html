<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dhamaka Admin Dashboard</title>
<style>
/* Base Styles - (Unchanged, copied from your provided code) */
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #1e1e1e; /* Dark background */
    color: #f0f0f0;
    margin: 0;
    padding: 0;
    min-height: 100vh;
}
header {
    background: #007bff; /* Blue for contrast */
    color: white;
    padding: 1em;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
    position: sticky;
    top: 0;
    z-index: 100;
    width: 100%; 
}
header h1 { margin: 0; font-size: 1.5em; }
header button {
    background: #dc3545;
    border: none;
    padding: 8px 15px;
    border-radius: 5px;
    cursor: pointer;
    color: white;
    font-weight: bold;
}
.hamburger {
    background: none;
    border: none;
    color: white;
    font-size: 2em;
    cursor: pointer;
    margin-right: 15px;
    display: block; 
    line-height: 0.5;
}
.sidebar {
    width: 250px;
    background: #282828; 
    padding: 1em 0;
    box-shadow: 2px 0 5px rgba(0, 0, 0, 0.5);
    flex-shrink: 0;
    transition: margin-left 0.3s ease-in-out;
    margin-left: 0; 
}
.sidebar.hidden {
    margin-left: -250px;
}
.main-content-container {
    display: flex;
    flex-grow: 1;
    overflow-x: hidden; 
    min-height: calc(100vh - 60px);
}
.main-content {
    flex-grow: 1;
    padding: 2em;
    overflow-y: auto;
    transition: width 0.3s ease-in-out;
}
.sidebar a {
    display: block;
    padding: 12px 20px;
    color: #f0f0f0;
    text-decoration: none;
    border-left: 4px solid transparent;
    transition: all 0.3s;
}
.sidebar a:hover, .sidebar a.active {
    background: #3a3a3a;
    border-left: 4px solid #28a745;
    color: #28a745;
}
.sidebar h3 {
    color: #999;
    padding: 0 20px;
    margin-top: 1.5em;
    font-size: 0.9em;
    text-transform: uppercase;
}
.dashboard-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 2em;
}
.card {
    background: #2f2f2f;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    text-align: center;
    transition: transform 0.3s;
}
.card:hover { transform: translateY(-5px); }
.card .value { font-size: 2.5em; font-weight: bold; color: #28a745; }
.card .label { font-size: 1em; color: #aaa; margin-top: 5px; }

/* Table Styles */
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 1em;
    background: #2f2f2f;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
}
th, td {
    border: 1px solid #3a3a3a;
    padding: 0.8em;
    text-align: center;
    font-size: 0.9em;
}
th {
    background: #3a3a3a;
    color: #fff;
    text-transform: uppercase;
    font-weight: 600;
}
input, select {
    padding: 0.4em;
    margin: 0.3em;
    border-radius: 4px;
    border: 1px solid #555;
    background: #3a3a3a;
    color: #f0f0f0;
}
/* Button Styles */
button {
    padding: 8px 12px;
    margin: 4px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.3s;
}
button.edit { background: #007bff; color: white; }
button.delete { background: #dc3545; color: white; }
button.approve { background: #28a745; color: white; }
button.reject { background: #ffc107; color: black; }
.form-group {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
    align-items: center;
    padding: 15px;
    background: #3a3a3a;
    border-radius: 8px;
    margin-bottom: 15px;
}
.form-group label { color: #aaa; }

/* Section visibility */
/* NOTE: Changed from .page-section to .page-content for clarity in structure */
.page-content {
    display: none;
    animation: fadeIn 0.5s;
}
.page-content.active {
    display: block;
}
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

/* Status Colors */
.status-pending { color: orange; font-weight: bold; }
.status-approved { color: #28a745; font-weight: bold; }
.status-rejected { color: #dc3545; font-weight: bold; }
</style>
</head>
<body>

<div id="loginPage" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #1e1e1e; z-index: 200; display: flex; justify-content: center; align-items: center;">
    <div style="background: #2f2f2f; padding: 40px; border-radius: 10px; box-shadow: 0 0 20px rgba(0,0,0,0.5); text-align: center;">
        <h2>Admin Login</h2>
        <div id="loginMsg" style="color:red; margin-bottom: 15px;"></div>
        <input type="text" id="adminId" placeholder="Admin ID (admin)" value="admin" style="display: block; width: 250px; margin: 10px auto;">
        <input type="password" id="adminPass" placeholder="Password (admin123)" value="admin123" style="display: block; width: 250px; margin: 10px auto;">
        <button class="approve" onclick="adminLogin()">Login</button>
    </div>
</div>

<div id="mainContainer" style="display: none;">
    <header>
        <div style="display: flex; align-items: center;">
            <button class="hamburger" onclick="toggleSidebar()">‚ò∞</button>
            <h1>Admin Dashboard</h1>
        </div>
        <div>
            <a href="index.html" target="_blank" style="margin-right: 15px; color: #ffc107; text-decoration: none; font-weight: bold;">View Shop</a>
            <button onclick="logout()">Logout</button>
        </div>
    </header>

    <div class="main-content-container"> 
        <div id="sidebar" class="sidebar">
            <a href="#" class="active" onclick="showSection('dashboard', this)">üìä Dashboard</a>
            
            <h3>Management</h3>
            <a href="#" onclick="showSection('vendor-management', this)">üë• Vendors</a>
            <a href="#" onclick="showSection('product-management', this)">üì¶ Products</a>
            <a href="#" onclick="showSection('order-management', this)">üõí Orders</a>
            <a href="#" onclick="showSection('promo-management', this)">üè∑Ô∏è Promocodes</a>
            <a href="#" onclick="showSection('banner-management', this)">üñºÔ∏è Banners</a>
            <a href="#" onclick="showSection('customer-management', this)">üßë Customers</a>
        </div>

        <div class="main-content">
            
            <div id="dashboard" class="page-content active">
                <h2>Dashboard Overview</h2>
                <div class="dashboard-cards">
                    <div class="card">
                        <div class="value" id="totalVendors">0</div>
                        <div class="label">Total Vendors</div>
                    </div>
                    <div class="card">
                        <div class="value" id="totalProducts">0</div>
                        <div class="label">Total Approved Products</div>
                    </div>
                    <div class="card">
                        <div class="value" id="totalOrders">0</div>
                        <div class="label">Total Orders</div>
                    </div>
                    <div class="card">
                        <div class="value" id="pendingApprovals">0</div>
                        <div class="label">Pending Approvals</div>
                    </div>
                </div>
                
                <h3>Recent Pending Approvals</h3>
                <table id="pendingTable">
                    <thead>
                        <tr><th>Type</th><th>Name</th><th>Date</th><th>Actions</th></tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            
            <div id="vendor-management" class="page-content">
                <h2>Vendor Approvals & Management</h2>
                <table id="vendorTable">
                    <thead>
                        <tr>
                            <th>ID</th><th>Name (Contact)</th><th>Status</th><th>Promocode</th><th>Actions</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <div id="product-management" class="page-content">
                <h2>Product Approvals & Management</h2>
                <table id="productTable">
                    <thead>
                        <tr>
                            <th>Status</th><th>Name</th><th>Vendor</th><th>Price</th><th>Stock</th><th>Category</th><th>Assigned Promo</th><th>Actions</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <div id="order-management" class="page-content">
                <h2>Order Management</h2>
                <table id="orderTable">
                    <thead>
                        <tr>
                            <th>Order ID</th><th>Customer</th><th>Total</th><th>Promocode</th><th>Status</th><th>Actions</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <div id="promo-management" class="page-content">
                <h2>Promocode Management</h2>
                <div id="promoForm">
                    <h3>Add/Edit Promocode</h3>
                    <input type="hidden" id="editPromoCode">
                    <div class="form-group">
                        <label>Code:</label><input type="text" id="promoCode" placeholder="E.g., SALE20">
                        <label>Discount:</label><input type="number" id="promoDiscount" placeholder="Value (e.g., 20)">
                        <label>Type:</label>
                        <select id="promoType">
                            <option value="percent">Percentage (%)</option>
                            <option value="fixed">Fixed Amount ($)</option>
                        </select>
                        <label>Min. Order:</label><input type="number" id="promoMinOrder" value="0" min="0">
                    </div>
                    <button class="approve" onclick="savePromocode()">Save Promocode</button>
                    <button class="reject" onclick="resetPromoForm()">Cancel</button>
                </div>

                <table id="promocodeTable">
                    <thead>
                        <tr>
                            <th>Code</th><th>Discount</th><th>Type</th><th>Min. Order</th><th>Scope</th><th>Usage Count</th><th>Actions</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <div id="banner-management" class="page-content">
                <h2>Banner Management (Carousel)</h2>
                <div id="bannerForm">
                    <h3>Add/Edit Banner</h3>
                    <input type="hidden" id="editBannerId">
                    <div class="form-group">
                        <label>Image URL:</label><input type="url" id="bannerImageURL" placeholder="Image URL (Public link)" style="width: 400px;">
                        <label>Link URL:</label><input type="url" id="bannerLinkURL" placeholder="Link (e.g., #categories or full URL)" style="width: 400px;">
                    </div>
                    <button class="approve" onclick="saveBanner()">Save Banner</button>
                </div>

                <table id="bannerTable">
                    <thead>
                        <tr>
                            <th>Preview</th><th>Image URL</th><th>Link URL</th><th>Actions</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div id="customer-management" class="page-content">
                <h2>Customers</h2>
                <table id="customerTable">
                    <thead>
                        <tr>
                            <th>Username</th><th>WhatsApp</th><th>Address</th><th>Actions</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

        </div>
    </div>
</div>

<script>
// ======= ADMIN CREDENTIALS (for robust login) =======
const ADMIN_CRED = {id:"admin",password:"admin123"};

// ======= GLOBAL DATA STATE =======
let vendors = [];
let customers = [];
let products = [];
let orders = [];
let masterPromocodes = [];
let banners = [];
let promocodeUsage = {};
let loggedAdmin = null; // Changed to null initially

// ======= DATA LOAD & SAVE =======
function loadData() {
    vendors = JSON.parse(localStorage.getItem("vendors")||'[]');
    customers = JSON.parse(localStorage.getItem("customers")||'[]');
    products = JSON.parse(localStorage.getItem("products")||'[]');
    orders = JSON.parse(localStorage.getItem("orders")||'[]');
    masterPromocodes = JSON.parse(localStorage.getItem("masterPromocodes")||'[]');
    banners = JSON.parse(localStorage.getItem("banners")||'[]');
    promocodeUsage = JSON.parse(localStorage.getItem("promocodeUsage")||'{}');
}

function saveAllData(){
    localStorage.setItem("vendors",JSON.stringify(vendors));
    localStorage.setItem("customers",JSON.stringify(customers));
    localStorage.setItem("products",JSON.stringify(products));
    localStorage.setItem("orders",JSON.stringify(orders));
    localStorage.setItem("masterPromocodes",JSON.stringify(masterPromocodes));
    localStorage.setItem("banners",JSON.stringify(banners));
    localStorage.setItem("promocodeUsage",JSON.stringify(promocodeUsage));
}

// üõë NEW/UPDATED: Admin Login Logic
function checkLoginStatus(){
    loggedAdmin = JSON.parse(localStorage.getItem("loggedAdmin")||'null');
    loadData(); // Load data initially

    const loginPage = document.getElementById('loginPage');
    const mainContainer = document.getElementById('mainContainer');

    if(loggedAdmin && loggedAdmin.id === ADMIN_CRED.id){
        // Logged in
        loginPage.style.display = 'none';
        mainContainer.style.display = 'block';
        showSection('dashboard', document.querySelector('.sidebar a.active')); // Show dashboard initially
        initRender();
    } else {
        // Not logged in
        loginPage.style.display = 'flex';
        mainContainer.style.display = 'none';
    }
}

function adminLogin(){
    const id = document.getElementById('adminId').value;
    const pass = document.getElementById('adminPass').value;
    const msg = document.getElementById('loginMsg');

    if (id === ADMIN_CRED.id && pass === ADMIN_CRED.password) {
        loggedAdmin = ADMIN_CRED;
        localStorage.setItem("loggedAdmin",JSON.stringify(loggedAdmin));
        msg.innerText = '';
        checkLoginStatus(); // Re-check status and redirect
    } else {
        msg.innerText = 'Invalid Admin ID or Password';
    }
}

// ======= NAVIGATION AND UI CONTROL =======
function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    sidebar.classList.toggle('hidden');
}

// üõë FIX: Changed .page-section to .page-content and removed element parameter logic for simplicity
function showSection(sectionId, element) {
    // 1. Hide all page sections
    document.querySelectorAll('.page-content').forEach(sec => sec.classList.remove('active'));
    
    // 2. Show the target section
    const targetElement = document.getElementById(sectionId);
    if(targetElement) {
        targetElement.classList.add('active');
    }

    // 3. Update sidebar active class
    document.querySelectorAll('.sidebar a').forEach(a => a.classList.remove('active'));
    if (element) {
        element.classList.add('active');
    }
    
    // 4. Re-render data for the entire dashboard structure
    initRender(); 
}

function logout(){
    localStorage.removeItem("loggedAdmin");
    loggedAdmin = null;
    alert("Admin logged out");
    checkLoginStatus(); // Redirect to login page
}

// ======= HELPER FUNCTIONS (Unchanged) =======
function getVendorName(vendorId){
    return vendors.find(v=>v.id===vendorId)?.name || "Unknown Vendor";
}

// ======= RENDER FUNCTIONS (Unchanged - using your existing logic) =======

function renderDashboard() {
    const approvedProducts = products.filter(p => p.status === 'Approved').length;
    const pendingProducts = products.filter(p => p.status === 'Pending').length;
    const pendingVendors = vendors.filter(v => v.status === 'Pending').length;
    
    document.getElementById('totalVendors').innerText = vendors.length;
    document.getElementById('totalProducts').innerText = approvedProducts;
    document.getElementById('totalOrders').innerText = orders.length;
    document.getElementById('pendingApprovals').innerText = pendingProducts + pendingVendors;

    const pendingTableBody = document.querySelector("#pendingTable tbody");
    pendingTableBody.innerHTML = '';

    const recentPending = [
        ...vendors.filter(v => v.status === 'Pending').map(v => ({
            type: 'Vendor',
            name: v.name,
            actions: `<button class="approve" onclick="approveVendorById('${v.id}')">Approve</button> <button class="reject" onclick="rejectVendorById('${v.id}')">Reject</button>`,
            sortId: v.id 
        })),
        ...products.filter(p => p.status === 'Pending').map(p => ({
            type: 'Product',
            name: p.name,
            actions: `<button class="approve" onclick="approveProductById(${p.id})">Approve</button> <button class="reject" onclick="rejectProductById(${p.id})">Reject</button>`,
            sortId: p.id
        }))
    ];

    recentPending.slice(0, 5).forEach(item => { 
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${item.type}</td>
            <td>${item.name}</td>
            <td>N/A</td> 
            <td>${item.actions}</td>
        `;
        pendingTableBody.appendChild(tr);
    });

    window.approveVendorById = (id) => {
        const index = vendors.findIndex(v => v.id === id);
        if (index !== -1) { approveVendor(index); }
    };
    window.rejectVendorById = (id) => {
        const index = vendors.findIndex(v => v.id === id);
        if (index !== -1) { rejectVendor(index); }
    };
    window.approveProductById = (id) => {
        const index = products.findIndex(p => p.id === id);
        if (index !== -1) { approveProduct(index); }
    };
    window.rejectProductById = (id) => {
        const index = products.findIndex(p => p.id === id);
        if (index !== -1) { rejectProduct(index); }
    };
}


function renderVendors(){
    const tbody = document.querySelector("#vendorTable tbody");
    tbody.innerHTML="";
    vendors.forEach((v,i)=>{
        const tr=document.createElement("tr");
        const statusClass = v.status ? 'status-' + v.status.toLowerCase() : 'status-pending';
        tr.innerHTML=`
            <td>${v.id}</td>
            <td>${v.name} (<a href="https://wa.me/${v.whatsapp}" target="_blank">${v.whatsapp}</a>)</td>
            <td><span class="${statusClass}">${v.status}</span></td>
            <td>${v.promocode}</td>
            <td>
                ${v.status!=='Approved'?`<button class="approve" onclick="approveVendor(${i})">Approve</button>`:""}
                ${v.status!=='Rejected'?`<button class="reject" onclick="rejectVendor(${i})">Reject</button>`:""}
                <button class="delete" onclick="deleteVendor(${i})">Delete</button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

function approveVendor(i){
    vendors[i].status="Approved";
    saveAllData();
    initRender(); 
}

function rejectVendor(i){
    vendors[i].status="Rejected";
    saveAllData();
    initRender(); 
}

// üõë Vendor delete logic (Unchanged from last successful update)
function deleteVendor(i){
    const vendorToDelete = vendors[i];
    
    if(confirm(`Delete vendor ${vendorToDelete.name} (${vendorToDelete.id})? This will also delete ALL their products and remove their associated promocode from the master list.`)){
        
        products = products.filter(p => p.vendorId !== vendorToDelete.id);
        masterPromocodes = masterPromocodes.filter(p => p.vendorId !== vendorToDelete.id);
        vendors.splice(i,1);
        
        saveAllData();
        initRender();
        alert(`Vendor ${vendorToDelete.name}, their products, and their promocode have been deleted.`);
    }
}

// Product, Promo, Banner, Order, Customer management functions remain the same... (They are long and omitted here for brevity, assuming they are complete in your file)
// Note: If you copy this code block, ensure you paste the remaining functions from your previous file back in here.

function renderProductsTable(){
    const tbody = document.querySelector("#productTable tbody");
    tbody.innerHTML="";
    products.forEach((p,i)=>{
        const vendorName = getVendorName(p.vendorId);
        const tr=document.createElement("tr");
        const statusClass = p.status ? 'status-' + p.status.toLowerCase() : 'status-pending';

        tr.innerHTML=`
            <td><span class="${statusClass}">${p.status}</span></td>
            <td>${p.name}</td>
            <td>${vendorName}</td>
            <td>$${p.price.toFixed(2)}</td>
            <td>${p.stock}</td>
            <td>${p.category}</td>
            <td>${p.promoCodeAssigned || 'None'}</td>
            <td>
                ${p.status!=='Approved'?`<button class="approve" onclick="approveProduct(${i})">Approve</button>`:""}
                ${p.status!=='Rejected'?`<button class="reject" onclick="rejectProduct(${i})">Reject</button>`:""}
                <button class="delete" onclick="deleteProduct(${i})">Delete</button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

function approveProduct(i){
    products[i].status="Approved";
    saveAllData();
    initRender();
}

function rejectProduct(i){
    products[i].status="Rejected";
    saveAllData();
    initRender();
}

function deleteProduct(i){
    if(confirm(`Delete product ${products[i].name}?`)){
        products.splice(i,1);
        saveAllData();
        initRender();
    }
}

function resetPromoForm() {
    document.getElementById('editPromoCode').value = '';
    document.getElementById('promoCode').value = '';
    document.getElementById('promoDiscount').value = '';
    document.getElementById('promoType').value = 'percent';
    document.getElementById('promoMinOrder').value = 0;
}

function savePromocode(){
    const code = document.getElementById('promoCode').value.trim().toUpperCase();
    const discount = parseFloat(document.getElementById('promoDiscount').value);
    const type = document.getElementById('promoType').value;
    const minOrder = parseFloat(document.getElementById('promoMinOrder').value);
    const editCode = document.getElementById('editPromoCode').value;

    if (!code || isNaN(discount) || discount <= 0 || isNaN(minOrder) || minOrder < 0) {
        alert("Fill all fields correctly.");
        return;
    }

    const newPromo = {
        code,
        discount,
        type,
        minOrder,
        scope: 'global',
        expiry: '2026-12-31'
    };

    if (editCode) {
        const index = masterPromocodes.findIndex(p => p.code === editCode);
        if (index !== -1) {
            masterPromocodes[index] = { ...masterPromocodes[index], ...newPromo, scope: masterPromocodes[index].scope };
        }
    } else {
        if (masterPromocodes.some(p => p.code === code)) {
            alert("Promocode already exists.");
            return;
        }
        masterPromocodes.push(newPromo);
    }

    saveAllData();
    initRender();
    resetPromoForm();
}

function editPromocode(code){
    const promo = masterPromocodes.find(p => p.code === code);
    if (promo && promo.scope === 'global') {
        document.getElementById('editPromoCode').value = promo.code;
        document.getElementById('promoCode').value = promo.code;
        document.getElementById('promoDiscount').value = promo.discount;
        document.getElementById('promoType').value = promo.type;
        document.getElementById('promoMinOrder').value = promo.minOrder;
    } else if (promo && promo.scope === 'vendor') {
        alert("Vendor-specific promo codes cannot be edited by Admin here.");
    }
}

function deletePromocode(code){
    if(confirm(`Delete promocode ${code}?`)){
        masterPromocodes = masterPromocodes.filter(p => p.code !== code);
        saveAllData();
        initRender();
    }
}

function renderPromocodes(){
    const tbody = document.querySelector("#promocodeTable tbody");
    tbody.innerHTML="";
    masterPromocodes.forEach(p=>{
        const usageCount = promocodeUsage[p.code] || 0;
        const tr=document.createElement("tr");
        const scopeInfo = p.scope === 'vendor' ? `Vendor: ${p.vendorId}` : 'Global';
        tr.innerHTML=`
            <td>${p.code}</td>
            <td>${p.discount} ${p.type === 'percent' ? '%' : '$ Fixed'}</td>
            <td>${p.type}</td>
            <td>$${p.minOrder.toFixed(2)}</td>
            <td>${scopeInfo}</td>
            <td>${usageCount}</td>
            <td>
                <button class="edit" onclick="editPromocode('${p.code}')" ${p.scope === 'vendor' ? 'disabled' : ''}>Edit</button>
                <button class="delete" onclick="deletePromocode('${p.code}')">Delete</button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

function saveBanner(){
    const imageURL = document.getElementById('bannerImageURL').value.trim();
    const linkURL = document.getElementById('bannerLinkURL').value.trim();
    const editId = parseInt(document.getElementById('editBannerId').value);

    if (!imageURL) {
        alert("Image URL is required.");
        return;
    }

    if (editId) {
        const index = banners.findIndex(b => b.id === editId);
        if (index !== -1) {
            banners[index].imageURL = imageURL;
            banners[index].link = linkURL || '#';
        }
    } else {
        const newId = banners.length > 0 ? Math.max(...banners.map(b => b.id)) + 1 : 1;
        banners.push({ id: newId, imageURL, link: linkURL || '#' });
    }

    saveAllData();
    initRender();
    document.getElementById('editBannerId').value = '';
    document.getElementById('bannerImageURL').value = '';
    document.getElementById('bannerLinkURL').value = '';
}

function editBanner(id){
    const banner = banners.find(b => b.id === id);
    if (banner) {
        document.getElementById('editBannerId').value = banner.id;
        document.getElementById('bannerImageURL').value = banner.imageURL;
        document.getElementById('bannerLinkURL').value = banner.link;
    }
}

function deleteBanner(id){
    if(confirm(`Delete banner ${id}?`)){
        banners = banners.filter(b => b.id !== id);
        saveAllData();
        initRender();
    }
}

function renderBanners(){
    const tbody = document.querySelector("#bannerTable tbody");
    tbody.innerHTML="";
    banners.forEach(b=>{
        const tr=document.createElement("tr");
        tr.innerHTML=`
            <td><img src="${b.imageURL}" style="width:100px; height:50px; object-fit:cover;"></td>
            <td>${b.imageURL}</td>
            <td><a href="${b.link}" target="_blank" style="color:#007bff;">${b.link}</a></td>
            <td>
                <button class="edit" onclick="editBanner(${b.id})">Edit</button>
                <button class="delete" onclick="deleteBanner(${b.id})">Delete</button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

function renderOrders(){
    const tbody = document.querySelector("#orderTable tbody");
    tbody.innerHTML="";
    orders.forEach((o,i)=>{
        const statusClass = o.status ? 'status-' + o.status.toLowerCase() : 'status-pending';

        tr=document.createElement("tr");
        tr.innerHTML=`
            <td>#${o.id} (${o.date ? new Date(o.date).toLocaleDateString() : 'N/A'})</td>
            <td>${o.customer}</td>
            <td>$${o.total}</td>
            <td>${o.promocode}</td>
            <td><span class="${statusClass}">${o.status}</span></td>
            <td>
                <select onchange="updateOrderStatus(${i},this.value)">
                    <option value="Pending" ${o.status==="Pending"?"selected":""}>Pending</option>
                    <option value="Completed" ${o.status==="Completed"?"selected":""}>Completed</option>
                    <option value="Cancelled" ${o.status==="Cancelled"?"selected":""}>Cancelled</option>
                    <option value="Shipped" ${o.status==="Shipped"?"selected":""}>Shipped</option>
                </select>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

function updateOrderStatus(i,status){
    orders[i].status=status;
    saveAllData();
    initRender();
}

function renderCustomers(){
    const tbody = document.querySelector("#customerTable tbody");
    tbody.innerHTML="";
    customers.forEach((c,i)=>{
        const tr=document.createElement("tr");
        tr.innerHTML=`
            <td>${c.username}</td>
            <td>${c.whatsapp}</td>
            <td>${c.address}</td>
            <td><button class="delete" onclick="deleteCustomer(${i})">Delete</button></td>
        `;
        tbody.appendChild(tr);
    });
}

function deleteCustomer(i){
    if(confirm(`Delete customer ${customers[i].username}?`)){
        customers.splice(i,1);
        saveAllData();
        initRender();
    }
}


// ======= INITIALIZATION =======
function initRender() {
    loadData();
    renderDashboard(); 
    renderVendors();
    renderCustomers();
    renderProductsTable();
    renderOrders();
    renderPromocodes();
    renderBanners(); 
}

// üõë Start the application by checking login status
document.addEventListener('DOMContentLoaded', () => {
    checkLoginStatus();
});

</script>
</body>
</html>
